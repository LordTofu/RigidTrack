\hypertarget{main_8h}{}\section{Rigid\+Track/main.h File Reference}
\label{main_8h}\index{Rigid\+Track/main.\+h@{Rigid\+Track/main.\+h}}


Header file for \hyperlink{main_8cpp}{main.\+cpp}.  


{\ttfamily \#include $<$fstream$>$}\newline
{\ttfamily \#include $<$windows.\+h$>$}\newline
{\ttfamily \#include $<$conio.\+h$>$}\newline
{\ttfamily \#include $<$tchar.\+h$>$}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$iostream$>$}\newline
{\ttfamily \#include $<$stdarg.\+h$>$}\newline
{\ttfamily \#include $<$ctype.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$gl/glu.\+h$>$}\newline
{\ttfamily \#include $<$sstream$>$}\newline
{\ttfamily \#include $<$thread$>$}\newline
{\ttfamily \#include $<$future$>$}\newline
{\ttfamily \#include $<$atomic$>$}\newline
{\ttfamily \#include \char`\"{}communication.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Rigid\+Track.\+h\char`\"{}}\newline
{\ttfamily \#include $<$Qt\+Widgets/\+Q\+Application$>$}\newline
{\ttfamily \#include $<$Q\+Udp\+Socket$>$}\newline
{\ttfamily \#include \char`\"{}cameralibrary.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}modulevector.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}modulevectorprocessing.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}coremath.\+h\char`\"{}}\newline
{\ttfamily \#include $<$opencv\textbackslash{}cv.\+h$>$}\newline
{\ttfamily \#include \char`\"{}opencv2\textbackslash{}core.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}opencv2\textbackslash{}calib3d.\+hpp\char`\"{}}\newline
{\ttfamily \#include $<$opencv2/imgproc/imgproc.\+hpp$>$}\newline
{\ttfamily \#include $<$opencv2/calib3d/calib3d.\+hpp$>$}\newline
{\ttfamily \#include $<$opencv2/highgui/highgui.\+hpp$>$}\newline
{\ttfamily \#include $<$opencv2\textbackslash{}video\textbackslash{}tracking.\+hpp$>$}\newline
Include dependency graph for main.\+h\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{main_8h__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{main_8h__dep__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{main_8h_a3d3afd29ce54eb7fc5cc7e74ab666586}{start\+Tracking} ()
\item 
\mbox{\Hypertarget{main_8h_a25183e8d0b386ef12b557efc712a0261}\label{main_8h_a25183e8d0b386ef12b557efc712a0261}} 
void \hyperlink{main_8h_a25183e8d0b386ef12b557efc712a0261}{start\+Stop\+Camera} ()
\begin{DoxyCompactList}\small\item\em Start or stop the tracking depending on if the camera is currently running or not. \end{DoxyCompactList}\item 
int \hyperlink{main_8h_a1e6662e0f16887fe97c7bebe05065972}{set\+Reference} ()
\item 
\mbox{\Hypertarget{main_8h_a5f7c5996cd5a271d0277e0741f73a5b4}\label{main_8h_a5f7c5996cd5a271d0277e0741f73a5b4}} 
int \hyperlink{main_8h_a5f7c5996cd5a271d0277e0741f73a5b4}{calibrate\+Camera} ()
\begin{DoxyCompactList}\small\item\em Start the camera calibration routine that computes the camera matrix and distortion coefficients. \end{DoxyCompactList}\item 
void \hyperlink{main_8h_ad39626702ff983d5fdab4b703bfaf964}{load\+Calibration} (int method)
\item 
void \hyperlink{main_8h_a847c0fbd3e513fb76ff145b31a9f5c37}{test\+Algorithms} ()
\item 
void \hyperlink{main_8h_a2104a5d9d6b9f1e29bc4cd858c59882e}{project\+Coordinate\+Frame} (Mat picture\+Frame)
\item 
\mbox{\Hypertarget{main_8h_ae624b0189bc5e32cbbb1f178b9f1a360}\label{main_8h_ae624b0189bc5e32cbbb1f178b9f1a360}} 
void \hyperlink{main_8h_ae624b0189bc5e32cbbb1f178b9f1a360}{set\+Up\+U\+DP} ()
\begin{DoxyCompactList}\small\item\em Open the U\+DP ports for communication. \end{DoxyCompactList}\item 
void \hyperlink{main_8h_ad19da4e648bbdc80d3123eb94711588e}{set\+Heading\+Offset} (double d)
\item 
void \hyperlink{main_8h_a54b6b6db348b48d21e1265e22829c61f}{send\+Data\+U\+DP} (cv\+::\+Vec3d \&Position, cv\+::\+Vec3d \&Euler)
\item 
void \hyperlink{main_8h_af2a8b7de0b15dc17198c147ba39e85f3}{close\+U\+DP} ()
\item 
void \hyperlink{main_8h_a56c7f641859cb2b6b99b0947d03be800}{load\+Marker\+Config} (int method)
\item 
void \hyperlink{main_8h_af6430ad2592a955a3618549547dfc5be}{draw\+Position\+Text} (cv\+::\+Mat \&Picture, cv\+::\+Vec3d \&Position, cv\+::\+Vec3d \&Euler, double error)
\item 
void \hyperlink{main_8h_af39fa6c3a36ad6bc24a327db7a9d73c2}{load\+Camera\+Position} ()
\item 
int \hyperlink{main_8h_a0416912fce6274568e80019b10ba294f}{determine\+Exposure} ()
\item 
void \hyperlink{main_8h_a11ff459289305229597defd39f510959}{determine\+Order} ()
\item 
int \hyperlink{main_8h_a7ad2e3cfb5056dbab2098e0dd3bd353f}{calibrate\+Ground} ()
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{main_8h_ab5e634b66221f494504aea1557af5df9}\label{main_8h_ab5e634b66221f494504aea1557af5df9}} 
int \hyperlink{main_8h_ab5e634b66221f494504aea1557af5df9}{method\+P\+NP}
\begin{DoxyCompactList}\small\item\em solve\+P\+NP algorithm 0 = iterative 1 = E\+P\+NP 2 = P3P 4 = U\+P\+NP //!$<$ 4 and 1 are the same and not implemented correctly by Open\+CV \end{DoxyCompactList}\item 
\mbox{\Hypertarget{main_8h_aa6266eedab8b3c011be53baffbfc42ab}\label{main_8h_aa6266eedab8b3c011be53baffbfc42ab}} 
bool \hyperlink{main_8h_aa6266eedab8b3c011be53baffbfc42ab}{safety\+Enable}
\begin{DoxyCompactList}\small\item\em is the safety feature enabled \end{DoxyCompactList}\item 
\mbox{\Hypertarget{main_8h_a436fb814ccc3f02617dade4dc6511143}\label{main_8h_a436fb814ccc3f02617dade4dc6511143}} 
bool \hyperlink{main_8h_a436fb814ccc3f02617dade4dc6511143}{safety2\+Enable}
\begin{DoxyCompactList}\small\item\em is the second receiver enabled \end{DoxyCompactList}\item 
\mbox{\Hypertarget{main_8h_a2c1b807fcb2de5a6759bd60ccae6dd7e}\label{main_8h_a2c1b807fcb2de5a6759bd60ccae6dd7e}} 
double \hyperlink{main_8h_a2c1b807fcb2de5a6759bd60ccae6dd7e}{safety\+Box\+Length}
\begin{DoxyCompactList}\small\item\em length of the safety area cube in meters \end{DoxyCompactList}\item 
\mbox{\Hypertarget{main_8h_ae65386c3310ab826e84fba757296de9a}\label{main_8h_ae65386c3310ab826e84fba757296de9a}} 
int \hyperlink{main_8h_ae65386c3310ab826e84fba757296de9a}{safety\+Angle}
\begin{DoxyCompactList}\small\item\em bank and pitch angle protection in degrees \end{DoxyCompactList}\item 
\mbox{\Hypertarget{main_8h_ab97ac0d82b1753d0eef37089be17e5e1}\label{main_8h_ab97ac0d82b1753d0eef37089be17e5e1}} 
Q\+Host\+Address \hyperlink{main_8h_ab97ac0d82b1753d0eef37089be17e5e1}{I\+P\+Adress\+Object}
\begin{DoxyCompactList}\small\item\em I\+Pv4 adress of receiver 1. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{main_8h_afefb1102a8a4a71b55d6f24f46404cc5}\label{main_8h_afefb1102a8a4a71b55d6f24f46404cc5}} 
Q\+Host\+Address \hyperlink{main_8h_afefb1102a8a4a71b55d6f24f46404cc5}{I\+P\+Adress\+Safety}
\begin{DoxyCompactList}\small\item\em I\+Pv4 adress of safety receiver. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{main_8h_a354806cf8cbface3575f2541d8fbcbda}\label{main_8h_a354806cf8cbface3575f2541d8fbcbda}} 
Q\+Host\+Address \hyperlink{main_8h_a354806cf8cbface3575f2541d8fbcbda}{I\+P\+Adress\+Safety2}
\begin{DoxyCompactList}\small\item\em I\+Pv4 adress of receiver 2. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{main_8h_a9a00043c93a3362969c1c1fcd3a70fea}\label{main_8h_a9a00043c93a3362969c1c1fcd3a70fea}} 
int \hyperlink{main_8h_a9a00043c93a3362969c1c1fcd3a70fea}{port\+Object}
\begin{DoxyCompactList}\small\item\em Port of receiver 1. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{main_8h_a137bc8cc9d53ad9b176c988a99bc7142}\label{main_8h_a137bc8cc9d53ad9b176c988a99bc7142}} 
int \hyperlink{main_8h_a137bc8cc9d53ad9b176c988a99bc7142}{port\+Safety}
\begin{DoxyCompactList}\small\item\em Port of the safety receiver. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{main_8h_a2601be9c226be24c71ec8282f632e723}\label{main_8h_a2601be9c226be24c71ec8282f632e723}} 
int \hyperlink{main_8h_a2601be9c226be24c71ec8282f632e723}{port\+Safety2}
\begin{DoxyCompactList}\small\item\em Port of receiver 2. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{main_8h_a5cc3bd09f5801804b7ae65846e0b9824}\label{main_8h_a5cc3bd09f5801804b7ae65846e0b9824}} 
int \hyperlink{main_8h_a5cc3bd09f5801804b7ae65846e0b9824}{invertZ}
\begin{DoxyCompactList}\small\item\em dummy variable to invert Z direction on request \end{DoxyCompactList}\item 
comm\+Object \hyperlink{main_8h_af29e7fc07ae0979d5fb61b473241d33d}{comm\+Obj}
\begin{DoxyCompactList}\small\item\em class that handles the communication from \hyperlink{main_8cpp}{main.\+cpp} to the G\+UI \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Header file for \hyperlink{main_8cpp}{main.\+cpp}. 

\begin{DoxyAuthor}{Author}
Florian J.\+T. Wachter 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+0 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
April, 8th 2017 
\end{DoxyDate}


\subsection{Function Documentation}
\mbox{\Hypertarget{main_8h_a7ad2e3cfb5056dbab2098e0dd3bd353f}\label{main_8h_a7ad2e3cfb5056dbab2098e0dd3bd353f}} 
\index{main.\+h@{main.\+h}!calibrate\+Ground@{calibrate\+Ground}}
\index{calibrate\+Ground@{calibrate\+Ground}!main.\+h@{main.\+h}}
\subsubsection{\texorpdfstring{calibrate\+Ground()}{calibrateGround()}}
{\footnotesize\ttfamily int calibrate\+Ground (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Get the pose of the camera w.\+r.\+t the ground calibration frame. This frame sets the navigation frame for later results. The pose is averaged over 200 samples and then saved in the file reference\+Data.\+xml. This routine is basically the same as set\+Reference. 

Definition at line 1581 of file main.\+cpp.


\begin{DoxyCode}
1582 \{\textcolor{comment}{}
1583 \textcolor{comment}{    //! initialize the variables with starting values}
1584 \textcolor{comment}{}    \hyperlink{main_8cpp_acf655f393e3996144226399a338e8d3b}{gotOrder} = \textcolor{keyword}{false};
1585     \hyperlink{main_8cpp_a9d2e25dbfda0ebcdbb488652c8b15fad}{posRef} = 0;
1586     \hyperlink{main_8cpp_acd6966c004a57c4080ba204152200e7f}{eulerRef} = 0;
1587     \hyperlink{main_8cpp_a4ee4d2abbe47b92c21b81c5c4389086e}{RmatRef} = 0;
1588     \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec} = \hyperlink{main_8cpp_ae101daeaec726e27690c862b7edea825}{RvecOriginal};
1589     \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec} = \hyperlink{main_8cpp_a043bf1deaf5d42d47e0cce8982c1f18b}{TvecOriginal};
1590 
1591     \hyperlink{main_8cpp_a0416912fce6274568e80019b10ba294f}{determineExposure}();
1592 
1593     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(\textcolor{stringliteral}{""});
1594     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"Started ground calibration"});
1595 
1596     CameraLibrary\_EnableDevelopment();\textcolor{comment}{}
1597 \textcolor{comment}{    //! Initialize Camera SDK ==--}
1598 \textcolor{comment}{}    CameraLibrary::CameraManager::X();
1599 \textcolor{comment}{}
1600 \textcolor{comment}{    //! At this point the Camera SDK is actively looking for all connected cameras and will initialize}
1601 \textcolor{comment}{    //! them on it's own.}
1602 \textcolor{comment}{}\textcolor{comment}{}
1603 \textcolor{comment}{    //! Get a connected camera ================----}
1604 \textcolor{comment}{}    CameraManager::X().WaitForInitialization();
1605     Camera *camera = CameraManager::X().GetCamera();
1606 \textcolor{comment}{}
1607 \textcolor{comment}{    //! If no device connected, pop a message box and exit ==--}
1608 \textcolor{comment}{}    \textcolor{keywordflow}{if} (camera == 0)
1609     \{
1610         \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"No camera found!"});
1611         \textcolor{keywordflow}{return} 1;
1612     \}
1613 \textcolor{comment}{}
1614 \textcolor{comment}{    //! Determine camera resolution to size application window ==----}
1615 \textcolor{comment}{}    \textcolor{keywordtype}{int} cameraWidth = camera->Width();
1616     \textcolor{keywordtype}{int} cameraHeight = camera->Height();
1617     camera->GetDistortionModel(\hyperlink{main_8cpp_a9fba099569a2da23e458c2571f69652a}{distModel});
1618     cv::Mat matFrame(cv::Size(cameraWidth, cameraHeight), CV\_8UC1);
1619 \textcolor{comment}{}
1620 \textcolor{comment}{    //! Set camera mode to precision mode, it directly provides marker coordinates}
1621 \textcolor{comment}{}    camera->SetVideoType(Core::PrecisionMode);
1622 \textcolor{comment}{}
1623 \textcolor{comment}{    //! Start camera output ==--}
1624 \textcolor{comment}{}    camera->Start();
1625 \textcolor{comment}{}
1626 \textcolor{comment}{    //! Turn on some overlay text so it's clear things are     ===---}
1627 \textcolor{comment}{    //! working even if there is nothing in the camera's view. ===---}
1628 \textcolor{comment}{    //! Set some other parameters as well of the camera}
1629 \textcolor{comment}{}    camera->SetTextOverlay(\textcolor{keyword}{true});
1630     camera->SetFrameRate(\hyperlink{main_8cpp_aa5b833b78b107a1a04eb4edba151c0ba}{intFrameRate});
1631     camera->SetIntensity(\hyperlink{main_8cpp_a4e18b0b26ecc511ca7d2f2205313e537}{intIntensity});
1632     camera->SetIRFilter(\textcolor{keyword}{true});
1633     camera->SetContinuousIR(\textcolor{keyword}{false});
1634     camera->SetHighPowerMode(\textcolor{keyword}{false});
1635 \textcolor{comment}{}
1636 \textcolor{comment}{    //! sample some frames and calculate the position and attitude. then average those values and use that
       as zero position}
1637 \textcolor{comment}{}    \textcolor{keywordtype}{int} numberSamples = 0;
1638     \textcolor{keywordtype}{int} numberToSample = 200;
1639     \textcolor{keywordtype}{double} projectionError = 0;
1640 
1641     \textcolor{keywordflow}{while} (numberSamples < numberToSample)
1642     \{\textcolor{comment}{}
1643 \textcolor{comment}{        //! Fetch a new frame from the camera ===---}
1644 \textcolor{comment}{}        Frame *frame = camera->GetFrame();
1645 
1646         \textcolor{keywordflow}{if} (frame)
1647         \{\textcolor{comment}{}
1648 \textcolor{comment}{            //! Ok, we've received a new frame, lets do something}
1649 \textcolor{comment}{            //! with it.}
1650 \textcolor{comment}{}            \textcolor{keywordflow}{if} (frame->ObjectCount() == \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers})
1651             \{\textcolor{comment}{}
1652 \textcolor{comment}{                //!for(int i=0; i<frame->ObjectCount(); i++)}
1653 \textcolor{comment}{}                \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; i++)
1654                 \{
1655                     cObject *obj = frame->Object(i);
1656                     \hyperlink{main_8cpp_a54cb682bd037283c18b5a9a447ff5e5e}{list\_points2dUnsorted}[i] = cv::Point2d(obj->X(), obj->Y());
1657                 \}
1658 
1659                 \textcolor{keywordflow}{if} (\hyperlink{main_8cpp_acf655f393e3996144226399a338e8d3b}{gotOrder} == \textcolor{keyword}{false})
1660                 \{
1661                     \hyperlink{main_8cpp_a11ff459289305229597defd39f510959}{determineOrder}();
1662                 \}
1663 \textcolor{comment}{}
1664 \textcolor{comment}{                //! sort the 2d points with the correct indices as found in the preceeding order
       determination algorithm}
1665 \textcolor{comment}{}                \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} w = 0; w < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; w++)
1666                 \{
1667                     \hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d}[w] = \hyperlink{main_8cpp_a54cb682bd037283c18b5a9a447ff5e5e}{list\_points2dUnsorted}[
      \hyperlink{main_8cpp_ac06fee052099b9fc9f0826315bb64a4a}{pointOrderIndices}[w]];
1668                 \}
1669                 \hyperlink{main_8cpp_a85d3d8c8a0e3e9cfb6157c247470d934}{list\_points2dOld} = \hyperlink{main_8cpp_a54cb682bd037283c18b5a9a447ff5e5e}{list\_points2dUnsorted};
1670 \textcolor{comment}{}
1671 \textcolor{comment}{                //!Compute the pose from the 3D-2D corresponses}
1672 \textcolor{comment}{}                solvePnP(\hyperlink{main_8cpp_a933edb4ba1c0589d59020164c2f1ff87}{list\_points3d}, \hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d}, 
      \hyperlink{main_8cpp_a53e8957a459b639ca82d938157f3b085}{cameraMatrix}, \hyperlink{main_8cpp_a8d67876da148be9118bba1c0d017fb57}{distCoeffs}, \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec}, \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}, \hyperlink{main_8cpp_ab1cc9be1ff0871bc5de1eb4c2811ae3e}{useGuess}, 
      \hyperlink{main_8cpp_ab5e634b66221f494504aea1557af5df9}{methodPNP});
1673 \textcolor{comment}{}
1674 \textcolor{comment}{                //! project the marker 3d points with the solution into the camera image CoSy and calculate
       difference to true camera image}
1675 \textcolor{comment}{}                projectPoints(\hyperlink{main_8cpp_a933edb4ba1c0589d59020164c2f1ff87}{list\_points3d}, \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec}, \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}, 
      \hyperlink{main_8cpp_a53e8957a459b639ca82d938157f3b085}{cameraMatrix}, \hyperlink{main_8cpp_a8d67876da148be9118bba1c0d017fb57}{distCoeffs}, \hyperlink{main_8cpp_a7b88d0425a68875639d40a17079df819}{list\_points2dProjected});
1676                 projectionError = norm(\hyperlink{main_8cpp_a7b88d0425a68875639d40a17079df819}{list\_points2dProjected}, 
      \hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d});
1677 
1678                 \textcolor{keywordflow}{if} (projectionError > 3)
1679                 \{
1680                     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"Reprojection error is bigger than 3 pixel. Correct marker
       configuration loaded?\(\backslash\)nMarker position measured precisely?"});
1681                     frame->Release();
1682                     \textcolor{keywordflow}{return} 1;
1683                 \}
1684 
1685                 \textcolor{keywordtype}{double} maxValue = 0;
1686                 \textcolor{keywordtype}{double} minValue = 0;
1687                 minMaxLoc(\hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}.at<\textcolor{keywordtype}{double}>(2), &minValue, &maxValue);
1688 
1689                 \textcolor{keywordflow}{if} (maxValue > 10000 || minValue < 0)
1690                 \{
1691 
1692 
1693                     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"Negative z distance, thats not possible. Start the set zero
       routine again and check marker configurations."});
1694                     frame->Release();
1695                     \textcolor{keywordflow}{return} 1;
1696                 \}
1697 
1698                 \textcolor{keywordflow}{if} (norm(\hyperlink{main_8cpp_a1d543a183197268bcb54a06bf157852c}{positionOld}) - norm(\hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}) < 0.05)   \textcolor{comment}{//!<Iterative Method needs time
       to converge to solution}
1699 \textcolor{comment}{}                \{
1700                     add(\hyperlink{main_8cpp_a9d2e25dbfda0ebcdbb488652c8b15fad}{posRef}, \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}, \hyperlink{main_8cpp_a9d2e25dbfda0ebcdbb488652c8b15fad}{posRef});
1701                     add(\hyperlink{main_8cpp_acd6966c004a57c4080ba204152200e7f}{eulerRef}, \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec}, \hyperlink{main_8cpp_acd6966c004a57c4080ba204152200e7f}{eulerRef}); \textcolor{comment}{//!< That are not the values of yaw,
       roll and pitch yet! Rodriguez has to be called first. }
1702 \textcolor{comment}{}                    numberSamples++;    \textcolor{comment}{//!<-- one sample more :D}
1703 \textcolor{comment}{}                    \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.progressUpdate(numberSamples * 100 / numberToSample);
1704                 \}
1705                 \hyperlink{main_8cpp_a1d543a183197268bcb54a06bf157852c}{positionOld} = \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec};
1706 
1707                 Mat cFrame(480, 640, CV\_8UC3, Scalar(0, 0, 0));
1708                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; i++)
1709                 \{
1710                     circle(cFrame, Point(\hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d}[i].x, 
      \hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d}[i].y), 6, Scalar(0, 225, 0), 3);
1711                 \}
1712                 \hyperlink{main_8cpp_a2104a5d9d6b9f1e29bc4cd858c59882e}{projectCoordinateFrame}(cFrame);
1713                 projectPoints(\hyperlink{main_8cpp_a933edb4ba1c0589d59020164c2f1ff87}{list\_points3d}, \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec}, \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}, 
      \hyperlink{main_8cpp_a53e8957a459b639ca82d938157f3b085}{cameraMatrix}, \hyperlink{main_8cpp_a8d67876da148be9118bba1c0d017fb57}{distCoeffs}, \hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d});
1714                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; i++)
1715                 \{
1716                     circle(cFrame, Point(\hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d}[i].x, 
      \hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d}[i].y), 3, Scalar(225, 0, 0), 3);
1717                 \}
1718 
1719                 QPixmap QPFrame;
1720                 QPFrame = \hyperlink{main_8cpp_a3e3cc959a7ab6f93ea52863d86373ce5}{Mat2QPixmap}(cFrame);
1721                 \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.changeImage(QPFrame);
1722                 QCoreApplication::processEvents();
1723 
1724             \}
1725             frame->Release();
1726         \}
1727     \}\textcolor{comment}{}
1728 \textcolor{comment}{    //! Release camera ==--}
1729 \textcolor{comment}{}    camera->Release();
1730 \textcolor{comment}{}
1731 \textcolor{comment}{    //!Divide by the number of samples to get the mean of the reference position}
1732 \textcolor{comment}{}    divide(\hyperlink{main_8cpp_a9d2e25dbfda0ebcdbb488652c8b15fad}{posRef}, numberToSample, \hyperlink{main_8cpp_a9d2e25dbfda0ebcdbb488652c8b15fad}{posRef});
1733     divide(\hyperlink{main_8cpp_acd6966c004a57c4080ba204152200e7f}{eulerRef}, numberToSample, \hyperlink{main_8cpp_acd6966c004a57c4080ba204152200e7f}{eulerRef}); \textcolor{comment}{//!< eulerRef is here in Axis Angle
       notation}
1734 \textcolor{comment}{}
1735     Rodrigues(\hyperlink{main_8cpp_acd6966c004a57c4080ba204152200e7f}{eulerRef}, \hyperlink{main_8cpp_a4ee4d2abbe47b92c21b81c5c4389086e}{RmatRef});                \textcolor{comment}{//!< axis angle to rotation matrix}
1736 \textcolor{comment}{}
1737     \hyperlink{main_8cpp_ab2b71933055cf32cc8e5e2100fd7723f}{getEulerAngles}(\hyperlink{main_8cpp_a4ee4d2abbe47b92c21b81c5c4389086e}{RmatRef}, \hyperlink{main_8cpp_acd6966c004a57c4080ba204152200e7f}{eulerRef}); \textcolor{comment}{//!<  rotation matrix to euler}
1738 \textcolor{comment}{}    \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(\textcolor{stringliteral}{""});
1739     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"RmatRef is:\(\backslash\)n"};
1740     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \hyperlink{main_8cpp_a4ee4d2abbe47b92c21b81c5c4389086e}{RmatRef} << \textcolor{stringliteral}{"\(\backslash\)n"};
1741     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"Reference Position is:\(\backslash\)n"};
1742     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \hyperlink{main_8cpp_a9d2e25dbfda0ebcdbb488652c8b15fad}{posRef} << \textcolor{stringliteral}{"[mm] \(\backslash\)n"};
1743     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"Reference Euler angles are:\(\backslash\)n"};
1744     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \hyperlink{main_8cpp_acd6966c004a57c4080ba204152200e7f}{eulerRef} << \textcolor{stringliteral}{"[deg] \(\backslash\)n"};
1745 \textcolor{comment}{}
1746 \textcolor{comment}{    //! Save the obtained calibration coefficients in a file for later use}
1747 \textcolor{comment}{}    QString fileName = QFileDialog::getSaveFileName(\textcolor{keyword}{nullptr}, \textcolor{stringliteral}{"Save ground calibration file"}, \textcolor{stringliteral}{"
      referenceData.xml"}, \textcolor{stringliteral}{"Calibration File (*.xml);;All Files (*)"});
1748     FileStorage fs(fileName.toUtf8().constData(), FileStorage::WRITE);
1749     fs << \textcolor{stringliteral}{"M\_NC"} << \hyperlink{main_8cpp_a4ee4d2abbe47b92c21b81c5c4389086e}{RmatRef};
1750     fs << \textcolor{stringliteral}{"eulerRef"} << \hyperlink{main_8cpp_acd6966c004a57c4080ba204152200e7f}{eulerRef};
1751     \hyperlink{main_8cpp_a7b795a27447192fa68ef7c2d8ee1adab}{strBuf} = fs.releaseAndGetString();
1752     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.changeStatus(QString::fromStdString(\hyperlink{main_8cpp_a7b795a27447192fa68ef7c2d8ee1adab}{strBuf}));
1753     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"Saved ground calibration!"});
1754     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.progressUpdate(0);
1755     \textcolor{keywordflow}{return} 0;
1756 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=321pt]{main_8h_a7ad2e3cfb5056dbab2098e0dd3bd353f_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_af2a8b7de0b15dc17198c147ba39e85f3}\label{main_8h_af2a8b7de0b15dc17198c147ba39e85f3}} 
\index{main.\+h@{main.\+h}!close\+U\+DP@{close\+U\+DP}}
\index{close\+U\+DP@{close\+U\+DP}!main.\+h@{main.\+h}}
\subsubsection{\texorpdfstring{close\+U\+D\+P()}{closeUDP()}}
{\footnotesize\ttfamily void close\+U\+DP (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Close the U\+DP ports again to release network interfaces etc. If this is not done the network resources are still occupied and the program can\textquotesingle{}t exit properly. 

Definition at line 1191 of file main.\+cpp.


\begin{DoxyCode}
1192 \{\textcolor{comment}{}
1193 \textcolor{comment}{    //! check if the socket is open and if yes close it}
1194 \textcolor{comment}{}    \textcolor{keywordflow}{if} (\hyperlink{main_8cpp_ae628b9aba095776b7134cf188486e174}{udpSocketObject}->isOpen())
1195     \{
1196         \hyperlink{main_8cpp_ae628b9aba095776b7134cf188486e174}{udpSocketObject}->close();
1197     \}
1198 
1199     \textcolor{keywordflow}{if} (\hyperlink{main_8cpp_a6aa0c3a69dc10d5c4432dcf62e2155d3}{udpSocketSafety}->isOpen())
1200     \{
1201         \hyperlink{main_8cpp_a6aa0c3a69dc10d5c4432dcf62e2155d3}{udpSocketSafety}->close();
1202     \}
1203 
1204     \textcolor{keywordflow}{if} (\hyperlink{main_8cpp_a4260e46da4e0e430642b2d8d8d3c7dd1}{udpSocketSafety2}->isOpen())
1205     \{
1206         \hyperlink{main_8cpp_a4260e46da4e0e430642b2d8d8d3c7dd1}{udpSocketSafety2}->close();
1207     \}
1208     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"Closed all UDP ports."});
1209 \}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{main_8h_af2a8b7de0b15dc17198c147ba39e85f3_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_a0416912fce6274568e80019b10ba294f}\label{main_8h_a0416912fce6274568e80019b10ba294f}} 
\index{main.\+h@{main.\+h}!determine\+Exposure@{determine\+Exposure}}
\index{determine\+Exposure@{determine\+Exposure}!main.\+h@{main.\+h}}
\subsubsection{\texorpdfstring{determine\+Exposure()}{determineExposure()}}
{\footnotesize\ttfamily int determine\+Exposure (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Get the optimal exposure for the camera. For that find the minimum and maximum exposure were the right number of markers are detected. Then the mean of those two values is used as exposure. 

Definition at line 1380 of file main.\+cpp.


\begin{DoxyCode}
1381 \{\textcolor{comment}{}
1382 \textcolor{comment}{    //! For OptiTrack Ethernet cameras, it's important to enable development mode if you}
1383 \textcolor{comment}{    //! want to stop execution for an extended time while debugging without disconnecting}
1384 \textcolor{comment}{    //! the Ethernet devices.  Lets do that now:}
1385 \textcolor{comment}{}
1386     CameraLibrary\_EnableDevelopment();
1387 \textcolor{comment}{}
1388 \textcolor{comment}{    //! Initialize Camera SDK ==--}
1389 \textcolor{comment}{}    CameraLibrary::CameraManager::X();
1390 \textcolor{comment}{}
1391 \textcolor{comment}{    //! At this point the Camera SDK is actively looking for all connected cameras and will initialize}
1392 \textcolor{comment}{    //! them on it's own.}
1393 \textcolor{comment}{}\textcolor{comment}{}
1394 \textcolor{comment}{    //! Get a connected camera ================----}
1395 \textcolor{comment}{}    CameraManager::X().WaitForInitialization();
1396     Camera *camera = CameraManager::X().GetCamera();
1397 \textcolor{comment}{}
1398 \textcolor{comment}{    //! If no device connected, pop a message box and exit ==--}
1399 \textcolor{comment}{}    \textcolor{keywordflow}{if} (camera == 0)
1400     \{
1401         \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"No camera found!"});
1402         \textcolor{keywordflow}{return} 1;
1403     \}
1404 \textcolor{comment}{}
1405 \textcolor{comment}{    //! Determine camera resolution to size application window ==----}
1406 \textcolor{comment}{}    \textcolor{keywordtype}{int} cameraWidth = camera->Width();
1407     \textcolor{keywordtype}{int} cameraHeight = camera->Height();
1408 
1409     camera->SetVideoType(Core::PrecisionMode);  \textcolor{comment}{//! set the camera mode to precision mode, it used
       greyscale imformation for marker property calculations}
1410 \textcolor{comment}{}\textcolor{comment}{}
1411 \textcolor{comment}{                                                //! Start camera output ==--}
1412 \textcolor{comment}{}    camera->Start();
1413 \textcolor{comment}{}
1414 \textcolor{comment}{    //! Turn on some overlay text so it's clear things are     ===---}
1415 \textcolor{comment}{    //! working even if there is nothing in the camera's view. ===---}
1416 \textcolor{comment}{}    camera->SetTextOverlay(\textcolor{keyword}{true});
1417     camera->SetExposure(\hyperlink{main_8cpp_afcaebd6cfd12b2e558363a06db8396ea}{intExposure});    \textcolor{comment}{//! set the camera exposure}
1418 \textcolor{comment}{}    camera->SetIntensity(\hyperlink{main_8cpp_a4e18b0b26ecc511ca7d2f2205313e537}{intIntensity}); \textcolor{comment}{//! set the camera infrared LED intensity}
1419 \textcolor{comment}{}    camera->SetFrameRate(\hyperlink{main_8cpp_aa5b833b78b107a1a04eb4edba151c0ba}{intFrameRate}); \textcolor{comment}{//! set the camera framerate to 100 Hz}
1420 \textcolor{comment}{}    camera->SetIRFilter(\textcolor{keyword}{true});  \textcolor{comment}{//! enable the filter that blocks visible light and only passes infrared
       light}
1421 \textcolor{comment}{}    camera->SetHighPowerMode(\textcolor{keyword}{true}); \textcolor{comment}{//! enable high power mode of the leds}
1422 \textcolor{comment}{}    camera->SetContinuousIR(\textcolor{keyword}{false}); \textcolor{comment}{//! enable continuous LED light}
1423 \textcolor{comment}{}    camera->SetThreshold(\hyperlink{main_8cpp_ac61559ce6020b8ec00161bc3a994ddcc}{intThreshold}); \textcolor{comment}{//! set threshold for marker detection}
1424 \textcolor{comment}{}\textcolor{comment}{}
1425 \textcolor{comment}{    //!set exposure such that num markers are visible}
1426 \textcolor{comment}{}    \textcolor{keywordtype}{int} numberObjects = 0;  \textcolor{comment}{//! Number of objects (markers) found in the current picture with the given
       exposure    }
1427 \textcolor{comment}{}    \textcolor{keywordtype}{int} minExposure = 1;    \textcolor{comment}{//! exposure when objects detected the first time is numberMarkers }
1428 \textcolor{comment}{}    \textcolor{keywordtype}{int} maxExposure = 480;  \textcolor{comment}{//! exposure when objects detected is first time numberMarkers+1}
1429 \textcolor{comment}{}    \hyperlink{main_8cpp_afcaebd6cfd12b2e558363a06db8396ea}{intExposure} = minExposure;   \textcolor{comment}{//! set the exposure to the smallest value possible}
1430 \textcolor{comment}{}    \textcolor{keywordtype}{int} numberTries = 0;    \textcolor{comment}{//! if the markers arent found after numberTries then there might be no markers
       at all in the real world}
1431 \textcolor{comment}{}\textcolor{comment}{}
1432 \textcolor{comment}{                            //! Determine minimum exposure, hence when are numberMarkers objects detected}
1433 \textcolor{comment}{}    camera->SetExposure(\hyperlink{main_8cpp_afcaebd6cfd12b2e558363a06db8396ea}{intExposure});
1434     \textcolor{keywordflow}{while} (numberObjects != \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers} && numberTries < 48)
1435     \{\textcolor{comment}{}
1436 \textcolor{comment}{        //! get a new camera frame}
1437 \textcolor{comment}{}        Frame *frame = camera->GetFrame();
1438         \textcolor{keywordflow}{if} (frame) \textcolor{comment}{//! frame received}
1439 \textcolor{comment}{}        \{
1440             numberObjects = frame->ObjectCount();   \textcolor{comment}{//! how many objects are detected in the image}
1441 \textcolor{comment}{}            \textcolor{keywordflow}{if} (numberObjects == \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}) \{ minExposure = 
      \hyperlink{main_8cpp_afcaebd6cfd12b2e558363a06db8396ea}{intExposure}; frame->Release(); \textcolor{keywordflow}{break}; \} \textcolor{comment}{//! if the right amount if markers is found, exit while
       loop}
1442 \textcolor{comment}{}\textcolor{comment}{            //! not the right amount of markers was found so increase the exposure and try again}
1443 \textcolor{comment}{}            numberTries++;
1444             \hyperlink{main_8cpp_afcaebd6cfd12b2e558363a06db8396ea}{intExposure} += 10;
1445             camera->SetExposure(\hyperlink{main_8cpp_afcaebd6cfd12b2e558363a06db8396ea}{intExposure});
1446             \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(\textcolor{stringliteral}{""});
1447             \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"Exposure: "} << \hyperlink{main_8cpp_afcaebd6cfd12b2e558363a06db8396ea}{intExposure} << \textcolor{stringliteral}{"\(\backslash\)t"};
1448             \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"Objects found: "} << numberObjects;
1449             \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(QString::fromStdString(\hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str()));
1450             frame->Release();
1451         \}
1452     \}
1453 \textcolor{comment}{}
1454 \textcolor{comment}{    //! Now determine maximum exposure, hence when are numberMarkers+1 objects detected}
1455 \textcolor{comment}{}    numberTries = 0;    \textcolor{comment}{//! if the markers arent found after numberTries then there might be no markers at
       all in the real world}
1456 \textcolor{comment}{}    intExposure = maxExposure;
1457     camera->SetExposure(intExposure);
1458     numberObjects = 0;
1459     \textcolor{keywordflow}{while} (numberObjects != \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers} && numberTries < 48)
1460     \{
1461         Frame *frame = camera->GetFrame();
1462         \textcolor{keywordflow}{if} (frame)
1463         \{
1464             numberObjects = frame->ObjectCount(); \textcolor{comment}{//! how many objects are detected in the image}
1465 \textcolor{comment}{}            \textcolor{keywordflow}{if} (numberObjects == \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}) \{ maxExposure = 
      \hyperlink{main_8cpp_afcaebd6cfd12b2e558363a06db8396ea}{intExposure}; frame->Release(); \textcolor{keywordflow}{break}; \} \textcolor{comment}{//! if the right amount if markers is found, exit while
       loop}
1466 \textcolor{comment}{}\textcolor{comment}{}
1467 \textcolor{comment}{            //! not the right amount of markers was found so decrease the exposure and try again}
1468 \textcolor{comment}{}            intExposure -= 10;
1469             numberTries++;
1470             camera->SetExposure(intExposure);
1471             \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(\textcolor{stringliteral}{""});
1472             \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"Exposure: "} << intExposure << \textcolor{stringliteral}{"\(\backslash\)t"};
1473             \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"Objects found: "} << numberObjects;
1474             \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(QString::fromStdString(\hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str()));
1475             frame->Release();
1476         \}
1477     \}
1478 \textcolor{comment}{}
1479 \textcolor{comment}{    //! set the exposure to the mean of min and max exposure determined}
1480 \textcolor{comment}{}    camera->SetExposure((minExposure + maxExposure) / 2.0);
1481 \textcolor{comment}{}
1482 \textcolor{comment}{    //! and now check if the correct amount of markers is detected with that new value}
1483 \textcolor{comment}{}    \textcolor{keywordflow}{while} (1)
1484     \{
1485         Frame *frame = camera->GetFrame();
1486         \textcolor{keywordflow}{if} (frame)
1487         \{
1488             numberObjects = frame->ObjectCount(); \textcolor{comment}{//! how many objects are detected in the image}
1489 \textcolor{comment}{}            \textcolor{keywordflow}{if} (numberObjects != \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}) \textcolor{comment}{//! are all markers and not more or less
       detected in the image}
1490 \textcolor{comment}{}            \{
1491                 frame->Release();
1492                 \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"Was not able to detect the right amount of markers."});\textcolor{comment}{}
1493 \textcolor{comment}{                //! Release camera ==--}
1494 \textcolor{comment}{}                camera->Release();
1495                 \textcolor{keywordflow}{return} 1;
1496             \}
1497             \textcolor{keywordflow}{else}  \textcolor{comment}{//! all markers and not more or less are found}
1498 \textcolor{comment}{}            \{
1499                 frame->Release();
1500                 intExposure = (minExposure + maxExposure) / 2.0;
1501                 \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"Found the correct number of markers."});
1502                 \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"Exposure set to:"});
1503                 \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(QString::number(intExposure));
1504                 \textcolor{keywordflow}{break};
1505             \}
1506         \}
1507     \}
1508 
1509     camera->Release();
1510     \textcolor{keywordflow}{return} 0;
1511 
1512 \}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{main_8h_a0416912fce6274568e80019b10ba294f_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_a11ff459289305229597defd39f510959}\label{main_8h_a11ff459289305229597defd39f510959}} 
\index{main.\+h@{main.\+h}!determine\+Order@{determine\+Order}}
\index{determine\+Order@{determine\+Order}!main.\+h@{main.\+h}}
\subsubsection{\texorpdfstring{determine\+Order()}{determineOrder()}}
{\footnotesize\ttfamily void determine\+Order (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Compute the order of the marker points in 2D so they are the same as in the 3D array. Hence marker 1 must be in first place for both, list\+\_\+points2d and list\+\_\+points3d. 

Definition at line 1516 of file main.\+cpp.


\begin{DoxyCode}
1517 \{\textcolor{comment}{}
1518 \textcolor{comment}{    //! determine the 3D-2D correspondences that are crucial for the PnP algorithm}
1519 \textcolor{comment}{    //! Try every possible correspondence and solve PnP}
1520 \textcolor{comment}{    //! Then project the 3D marker points into the 2D camera image and check the difference }
1521 \textcolor{comment}{    //! between projected points and points as seen by the camera}
1522 \textcolor{comment}{    //! the corresponce with the smallest difference is probably the correct one}
1523 \textcolor{comment}{}\textcolor{comment}{}
1524 \textcolor{comment}{        //! the difference between true 2D points and projected points is super big}
1525 \textcolor{comment}{}    \hyperlink{main_8cpp_ab826a7ca5876afdd6c0bccf04b73b30b}{minPointDistance} = 5000;
1526     std::sort(\hyperlink{main_8cpp_ac06fee052099b9fc9f0826315bb64a4a}{pointOrderIndices}, \hyperlink{main_8cpp_ac06fee052099b9fc9f0826315bb64a4a}{pointOrderIndices} + 4);
1527 \textcolor{comment}{}
1528 \textcolor{comment}{    //! now try every possible permutation of correspondence}
1529 \textcolor{comment}{}    \textcolor{keywordflow}{do} \{\textcolor{comment}{}
1530 \textcolor{comment}{        //! reset the starting values for solvePnP}
1531 \textcolor{comment}{}        \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec} = \hyperlink{main_8cpp_ae101daeaec726e27690c862b7edea825}{RvecOriginal};
1532         \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec} = \hyperlink{main_8cpp_a043bf1deaf5d42d47e0cce8982c1f18b}{TvecOriginal};
1533 \textcolor{comment}{}
1534 \textcolor{comment}{        //! sort the 2d points with the current permutation}
1535 \textcolor{comment}{}        \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} m = 0; m < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; m++)
1536         \{
1537             \hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d}[m] = \hyperlink{main_8cpp_a54cb682bd037283c18b5a9a447ff5e5e}{list\_points2dUnsorted}[
      \hyperlink{main_8cpp_ac06fee052099b9fc9f0826315bb64a4a}{pointOrderIndices}[m]];
1538         \}
1539 \textcolor{comment}{}
1540 \textcolor{comment}{        //! Call solve PNP with P3P since its more robust and sufficient for start value determination}
1541 \textcolor{comment}{}        solvePnP(\hyperlink{main_8cpp_a933edb4ba1c0589d59020164c2f1ff87}{list\_points3d}, \hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d}, 
      \hyperlink{main_8cpp_a53e8957a459b639ca82d938157f3b085}{cameraMatrix}, \hyperlink{main_8cpp_a8d67876da148be9118bba1c0d017fb57}{distCoeffs}, \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec}, \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}, \hyperlink{main_8cpp_ab1cc9be1ff0871bc5de1eb4c2811ae3e}{useGuess}, SOLVEPNP\_P3P);
1542 \textcolor{comment}{}
1543 \textcolor{comment}{        //! set the current difference of all point correspondences to zero}
1544 \textcolor{comment}{}        \hyperlink{main_8cpp_afe37bd67ad83a2d897cf5977cba70ef3}{currentPointDistance} = 0;
1545 \textcolor{comment}{}
1546 \textcolor{comment}{        //! project the 3D points with the solvePnP solution onto 2D}
1547 \textcolor{comment}{}        projectPoints(\hyperlink{main_8cpp_a933edb4ba1c0589d59020164c2f1ff87}{list\_points3d}, \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec}, \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}, 
      \hyperlink{main_8cpp_a53e8957a459b639ca82d938157f3b085}{cameraMatrix}, \hyperlink{main_8cpp_a8d67876da148be9118bba1c0d017fb57}{distCoeffs}, \hyperlink{main_8cpp_a7b88d0425a68875639d40a17079df819}{list\_points2dProjected});
1548 \textcolor{comment}{}
1549 \textcolor{comment}{        //! now compute the absolute difference (error)}
1550 \textcolor{comment}{}        \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} n = 0; n < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; n++)
1551         \{
1552             \hyperlink{main_8cpp_afe37bd67ad83a2d897cf5977cba70ef3}{currentPointDistance} += norm(\hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d}[n] - 
      \hyperlink{main_8cpp_a7b88d0425a68875639d40a17079df819}{list\_points2dProjected}[n]);
1553         \}
1554 \textcolor{comment}{}
1555 \textcolor{comment}{        //! if the difference with the current permutation is smaller than the smallest value till now}
1556 \textcolor{comment}{        //! it is probably the more correct permutation}
1557 \textcolor{comment}{}        \textcolor{keywordflow}{if} (\hyperlink{main_8cpp_afe37bd67ad83a2d897cf5977cba70ef3}{currentPointDistance} < \hyperlink{main_8cpp_ab826a7ca5876afdd6c0bccf04b73b30b}{minPointDistance})
1558         \{
1559             \hyperlink{main_8cpp_ab826a7ca5876afdd6c0bccf04b73b30b}{minPointDistance} = \hyperlink{main_8cpp_afe37bd67ad83a2d897cf5977cba70ef3}{currentPointDistance};    \textcolor{comment}{//!< set the
       smallest value of difference to the current one}
1560 \textcolor{comment}{}            \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} b = 0; b < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; b++)    \textcolor{comment}{//!< now safe the better permutation}
1561 \textcolor{comment}{}            \{
1562                 \hyperlink{main_8cpp_acc9e758efd664582db86f976cec195fa}{pointOrderIndicesNew}[b] = \hyperlink{main_8cpp_ac06fee052099b9fc9f0826315bb64a4a}{pointOrderIndices}[b];
1563             \}
1564         \}
1565 
1566 
1567     \}\textcolor{comment}{}
1568 \textcolor{comment}{    //! try every permutation }
1569 \textcolor{comment}{}    \textcolor{keywordflow}{while} (std::next\_permutation(\hyperlink{main_8cpp_ac06fee052099b9fc9f0826315bb64a4a}{pointOrderIndices}, 
      \hyperlink{main_8cpp_ac06fee052099b9fc9f0826315bb64a4a}{pointOrderIndices} + 4));
1570 \textcolor{comment}{}
1571 \textcolor{comment}{    //! now that the correct order is found assign it to the indices array}
1572 \textcolor{comment}{}    \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} w = 0; w < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; w++)
1573     \{
1574         \hyperlink{main_8cpp_ac06fee052099b9fc9f0826315bb64a4a}{pointOrderIndices}[w] = \hyperlink{main_8cpp_acc9e758efd664582db86f976cec195fa}{pointOrderIndicesNew}[w];
1575     \}
1576     \hyperlink{main_8cpp_acf655f393e3996144226399a338e8d3b}{gotOrder} = \textcolor{keyword}{true};
1577 \}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{main_8h_a11ff459289305229597defd39f510959_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_af6430ad2592a955a3618549547dfc5be}\label{main_8h_af6430ad2592a955a3618549547dfc5be}} 
\index{main.\+h@{main.\+h}!draw\+Position\+Text@{draw\+Position\+Text}}
\index{draw\+Position\+Text@{draw\+Position\+Text}!main.\+h@{main.\+h}}
\subsubsection{\texorpdfstring{draw\+Position\+Text()}{drawPositionText()}}
{\footnotesize\ttfamily void draw\+Position\+Text (\begin{DoxyParamCaption}\item[{cv\+::\+Mat \&}]{Picture,  }\item[{cv\+::\+Vec3d \&}]{Position,  }\item[{cv\+::\+Vec3d \&}]{Euler,  }\item[{double}]{error }\end{DoxyParamCaption})}

Draw the position, attitude and reprojection error in the picture. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em Picture} & is the camera image in Open\+CV matrix format. \\
\hline
\mbox{\tt in}  & {\em Position} & is the position of the tracked object in navigation Co\+Sy. \\
\hline
\mbox{\tt in}  & {\em Euler} & are the Euler angles with respect to the navigation frame. \\
\hline
\mbox{\tt in}  & {\em error} & is the reprojection error of the pose estimation. \\
\hline
\end{DoxyParams}


Definition at line 1333 of file main.\+cpp.


\begin{DoxyCode}
1334 \{
1335     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(\textcolor{stringliteral}{""});
1336     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"X: "} << Position[0] << \textcolor{stringliteral}{" m"};
1337     putText(Picture, \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(), cv::Point(200, 440), 1, 1, cv::Scalar(255, 255, 255));
1338 
1339     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(\textcolor{stringliteral}{""});
1340     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"Y: "} << Position[1] << \textcolor{stringliteral}{" m"};
1341     putText(Picture, \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(), cv::Point(200, 455), 1, 1, cv::Scalar(255, 255, 255));
1342 
1343     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(\textcolor{stringliteral}{""});
1344     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"Z: "} << Position[2] << \textcolor{stringliteral}{" m"};
1345     putText(Picture, \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(), cv::Point(200, 470), 1, 1, cv::Scalar(255, 255, 255));
1346 
1347     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(\textcolor{stringliteral}{""});
1348     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"Heading: "} << Euler[2]*180/3.1415 << \textcolor{stringliteral}{" deg"};
1349     putText(Picture, \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(), cv::Point(350, 440), 1, 1, cv::Scalar(255, 255, 255));
1350 
1351     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(\textcolor{stringliteral}{""});
1352     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"Pitch: "} << Euler[1] * 180 / 3.1415 << \textcolor{stringliteral}{" deg"};
1353     putText(Picture, \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(), cv::Point(350, 455), 1, 1, cv::Scalar(255, 255, 255));
1354 
1355     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(\textcolor{stringliteral}{""});
1356     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"Roll: "} << Euler[0] * 180 / 3.1415 << \textcolor{stringliteral}{" deg"};
1357     putText(Picture, \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(), cv::Point(350, 470), 1, 1, cv::Scalar(255, 255, 255));
1358 
1359     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(\textcolor{stringliteral}{""});
1360     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"Error: "} << error << \textcolor{stringliteral}{" px"};
1361     putText(Picture, \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(), cv::Point(10, 470), 1, 1, cv::Scalar(255, 255, 255));
1362 \}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{main_8h_af6430ad2592a955a3618549547dfc5be_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_ad39626702ff983d5fdab4b703bfaf964}\label{main_8h_ad39626702ff983d5fdab4b703bfaf964}} 
\index{main.\+h@{main.\+h}!load\+Calibration@{load\+Calibration}}
\index{load\+Calibration@{load\+Calibration}!main.\+h@{main.\+h}}
\subsubsection{\texorpdfstring{load\+Calibration()}{loadCalibration()}}
{\footnotesize\ttfamily void load\+Calibration (\begin{DoxyParamCaption}\item[{int}]{method }\end{DoxyParamCaption})}

Load a previously saved camera calibration from a file. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em method} & whether or not load the camera calibration from calibration.\+xml. If ==0 then yes, if != 0 then let the user select a different file. \\
\hline
\end{DoxyParams}


Definition at line 941 of file main.\+cpp.


\begin{DoxyCode}
941                                  \{
942 
943     QString fileName;
944     \textcolor{keywordflow}{if} (method == 0)
945     \{
946         fileName = \textcolor{stringliteral}{"calibration.xml"};
947     \}
948     \textcolor{keywordflow}{else}
949     \{
950         fileName = QFileDialog::getOpenFileName(\textcolor{keyword}{nullptr}, \textcolor{stringliteral}{"Choose a previous saved calibration file"}, \textcolor{stringliteral}{""}, \textcolor{stringliteral}{"
      Calibration Files (*.xml);;All Files (*)"});
951         \textcolor{keywordflow}{if} (fileName.length() == 0)
952         \{
953             fileName = \textcolor{stringliteral}{"calibration.xml"};
954         \}
955     \}
956     FileStorage fs;
957     fs.open(fileName.toUtf8().constData(), FileStorage::READ);
958     fs[\textcolor{stringliteral}{"CameraMatrix"}] >> \hyperlink{main_8cpp_a53e8957a459b639ca82d938157f3b085}{cameraMatrix};
959     fs[\textcolor{stringliteral}{"DistCoeff"}] >> \hyperlink{main_8cpp_a8d67876da148be9118bba1c0d017fb57}{distCoeffs};
960     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"Loaded calibration from file:"});
961     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(fileName);
962     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(\textcolor{stringliteral}{""});
963     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"\(\backslash\)nCamera Matrix is"} << \textcolor{stringliteral}{"\(\backslash\)n"} << cameraMatrix << \textcolor{stringliteral}{"\(\backslash\)n"};
964     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"\(\backslash\)nDistortion Coefficients are"} << \textcolor{stringliteral}{"\(\backslash\)n"} << distCoeffs << \textcolor{stringliteral}{"\(\backslash\)n"};
965     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(QString::fromStdString(\hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str()));
966 \}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=234pt]{main_8h_ad39626702ff983d5fdab4b703bfaf964_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_af39fa6c3a36ad6bc24a327db7a9d73c2}\label{main_8h_af39fa6c3a36ad6bc24a327db7a9d73c2}} 
\index{main.\+h@{main.\+h}!load\+Camera\+Position@{load\+Camera\+Position}}
\index{load\+Camera\+Position@{load\+Camera\+Position}!main.\+h@{main.\+h}}
\subsubsection{\texorpdfstring{load\+Camera\+Position()}{loadCameraPosition()}}
{\footnotesize\ttfamily void load\+Camera\+Position (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Load the rotation matrix from camera Co\+Sy to ground Co\+Sy It is determined during \hyperlink{main_8cpp_a7ad2e3cfb5056dbab2098e0dd3bd353f}{calibrate\+Ground()} and stays the same once the camera is mounted and fixed. 

Definition at line 1366 of file main.\+cpp.


\begin{DoxyCode}
1367 \{\textcolor{comment}{}
1368 \textcolor{comment}{    //! Open the referenceData.xml that contains the rotation from camera CoSy to ground CoSy}
1369 \textcolor{comment}{}    FileStorage fs;
1370     fs.open(\textcolor{stringliteral}{"referenceData.xml"}, FileStorage::READ);
1371     fs[\textcolor{stringliteral}{"M\_NC"}] >> \hyperlink{main_8cpp_af604b9538ec8923428a78439eaf55f8e}{M\_CN};
1372     fs[\textcolor{stringliteral}{"M\_NC"}] >> \hyperlink{main_8cpp_a4ee4d2abbe47b92c21b81c5c4389086e}{RmatRef};
1373     fs[\textcolor{stringliteral}{"posRef"}] >> \hyperlink{main_8cpp_a9d2e25dbfda0ebcdbb488652c8b15fad}{posRef};
1374     fs[\textcolor{stringliteral}{"eulerRef"}] >> \hyperlink{main_8cpp_acd6966c004a57c4080ba204152200e7f}{eulerRef};
1375     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"Loaded reference pose."});
1376 \}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=258pt]{main_8h_af39fa6c3a36ad6bc24a327db7a9d73c2_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_a56c7f641859cb2b6b99b0947d03be800}\label{main_8h_a56c7f641859cb2b6b99b0947d03be800}} 
\index{main.\+h@{main.\+h}!load\+Marker\+Config@{load\+Marker\+Config}}
\index{load\+Marker\+Config@{load\+Marker\+Config}!main.\+h@{main.\+h}}
\subsubsection{\texorpdfstring{load\+Marker\+Config()}{loadMarkerConfig()}}
{\footnotesize\ttfamily void load\+Marker\+Config (\begin{DoxyParamCaption}\item[{int}]{method }\end{DoxyParamCaption})}

Load a marker configuration from file. This file has to be created by hand, use the standard marker configuration file as template. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em method} & whether or not load the configuration from the marker\+Standard.\+xml. If ==0 load it, if != 0 let the user select a different file. \\
\hline
\end{DoxyParams}


Definition at line 1213 of file main.\+cpp.


\begin{DoxyCode}
1214 \{
1215     QString fileName;\textcolor{comment}{}
1216 \textcolor{comment}{    //! during start up of the programm load the standard marker configuration}
1217 \textcolor{comment}{}    \textcolor{keywordflow}{if} (method == 0)
1218     \{\textcolor{comment}{}
1219 \textcolor{comment}{        //! open the standard marker configuration file}
1220 \textcolor{comment}{}        FileStorage fs;
1221         fs.open(\textcolor{stringliteral}{"markerStandard.xml"}, FileStorage::READ);
1222 \textcolor{comment}{}
1223 \textcolor{comment}{        //! copy the values to the respective variables}
1224 \textcolor{comment}{}        fs[\textcolor{stringliteral}{"numberMarkers"}] >> \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers};
1225 \textcolor{comment}{}
1226 \textcolor{comment}{        //! inizialise vectors with correct length depending on the number of markers}
1227 \textcolor{comment}{}        \hyperlink{main_8cpp_a933edb4ba1c0589d59020164c2f1ff87}{list\_points3d} = std::vector<Point3d>(\hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers});
1228         \hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d} = std::vector<Point2d>(\hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers});
1229         \hyperlink{main_8cpp_a85d3d8c8a0e3e9cfb6157c247470d934}{list\_points2dOld} = std::vector<Point2d>(\hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers});
1230         \hyperlink{main_8cpp_aea88a68a83d84419dd1c5a93b21b1958}{list\_points2dDifference} = std::vector<double>(
      \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers});
1231         \hyperlink{main_8cpp_a7b88d0425a68875639d40a17079df819}{list\_points2dProjected} = std::vector<Point2d>(
      \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers});
1232         \hyperlink{main_8cpp_a54cb682bd037283c18b5a9a447ff5e5e}{list\_points2dUnsorted} = std::vector<Point2d>(
      \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers});
1233 \textcolor{comment}{}
1234 \textcolor{comment}{        //! save the marker locations in the points3d vector}
1235 \textcolor{comment}{}        fs[\textcolor{stringliteral}{"list\_points3d"}] >> \hyperlink{main_8cpp_a933edb4ba1c0589d59020164c2f1ff87}{list\_points3d};
1236         fs.release();
1237         \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"Loaded marker configuration from file:"});
1238         \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(fileName);
1239 
1240 
1241 
1242     \}
1243     \textcolor{keywordflow}{else}
1244     \{\textcolor{comment}{}
1245 \textcolor{comment}{        //! if the load marker configuration button was clicked show a open file dialog }
1246 \textcolor{comment}{}        fileName = QFileDialog::getOpenFileName(\textcolor{keyword}{nullptr}, \textcolor{stringliteral}{"Choose a previous saved marker configuration file
      "}, \textcolor{stringliteral}{""}, \textcolor{stringliteral}{"marker configuratio files (*.xml);;All Files (*)"});
1247 \textcolor{comment}{}
1248 \textcolor{comment}{        //! was cancel or abort clicked }
1249 \textcolor{comment}{}        \textcolor{keywordflow}{if} (fileName.length() == 0)
1250         \{\textcolor{comment}{}
1251 \textcolor{comment}{            //! if yes load the standard marker configuration}
1252 \textcolor{comment}{}            fileName = \textcolor{stringliteral}{"markerStandard.xml"};
1253         \}
1254 \textcolor{comment}{}
1255 \textcolor{comment}{        //! open the selected marker configuration file}
1256 \textcolor{comment}{}        FileStorage fs;
1257         fs.open(fileName.toUtf8().constData(), FileStorage::READ);
1258 \textcolor{comment}{}
1259 \textcolor{comment}{        //! copy the values to the respective variables}
1260 \textcolor{comment}{}        fs[\textcolor{stringliteral}{"numberMarkers"}] >> \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers};
1261 \textcolor{comment}{}
1262 \textcolor{comment}{        //! inizialise vectors with correct length depending on the number of markers}
1263 \textcolor{comment}{}        list\_points3d = std::vector<Point3d>(\hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers});
1264         list\_points2d = std::vector<Point2d>(\hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers});
1265         list\_points2dOld = std::vector<Point2d>(\hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers});
1266         list\_points2dDifference = std::vector<double>(\hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers});
1267         list\_points2dProjected = std::vector<Point2d>(\hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers});
1268         list\_points2dUnsorted = std::vector<Point2d>(\hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers});
1269 \textcolor{comment}{}
1270 \textcolor{comment}{        //! save the marker locations in the points3d vector}
1271 \textcolor{comment}{}        fs[\textcolor{stringliteral}{"list\_points3d"}] >> \hyperlink{main_8cpp_a933edb4ba1c0589d59020164c2f1ff87}{list\_points3d};
1272         fs.release();
1273         \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"Loaded marker configuration from file:"});
1274         \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(fileName);
1275 
1276     \}
1277 \textcolor{comment}{}
1278 \textcolor{comment}{    //! Print out the number of markers and their position to the GUI}
1279 \textcolor{comment}{}    \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(\textcolor{stringliteral}{""});
1280     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"Number of Markers: "} << numberMarkers << \textcolor{stringliteral}{"\(\backslash\)n"};
1281     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"Marker 3D Points X,Y and Z [mm]: \(\backslash\)n"};
1282     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; i++)
1283     \{
1284         \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"Marker "} << i + 1 << \textcolor{stringliteral}{":\(\backslash\)t"} << list\_points3d[i].x << \textcolor{stringliteral}{"\(\backslash\)t"} << list\_points3d[i].y << \textcolor{stringliteral}{"\(\backslash\)t"} << 
      list\_points3d[i].z << \textcolor{stringliteral}{"\(\backslash\)n"};
1285     \}
1286     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(QString::fromStdString(\hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str()));
1287 \textcolor{comment}{}
1288 \textcolor{comment}{    //! check if P3P algorithm can be enabled, it needs exactly 4 marker points to work}
1289 \textcolor{comment}{}    \textcolor{keywordflow}{if} (numberMarkers == 4)
1290     \{\textcolor{comment}{}
1291 \textcolor{comment}{        //! if P3P is possible, let the user choose which algorithm he wants but keep iterative active}
1292 \textcolor{comment}{}        \hyperlink{main_8cpp_ab5e634b66221f494504aea1557af5df9}{methodPNP} = 0;
1293         \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.enableP3P(\textcolor{keyword}{true});
1294     \}
1295     \textcolor{keywordflow}{else}
1296     \{\textcolor{comment}{}
1297 \textcolor{comment}{        //! More (or less) marker than 4 loaded, P3P is not possible, hence user cant select P3P in GUI}
1298 \textcolor{comment}{}        \hyperlink{main_8cpp_ab5e634b66221f494504aea1557af5df9}{methodPNP} = 0;
1299         \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.enableP3P(\textcolor{keyword}{false});
1300         \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"P3P algorithm disabled, only works with 4 markers."});
1301     \}
1302 \textcolor{comment}{}
1303 \textcolor{comment}{    //! now display the marker configuration in the camera view }
1304 \textcolor{comment}{}    Mat cFrame(480, 640, CV\_8UC3, Scalar(0, 0, 0));
1305 \textcolor{comment}{}
1306 \textcolor{comment}{    //! Set the camera pose parallel to the marker coordinate system}
1307 \textcolor{comment}{}    \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}.at<\textcolor{keywordtype}{double}>(0) = 0;
1308     \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}.at<\textcolor{keywordtype}{double}>(1) = 0;
1309     \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}.at<\textcolor{keywordtype}{double}>(2) = 4500;
1310     \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec}.at<\textcolor{keywordtype}{double}>(0) = 0 * 3.141592653589 / 180.0;
1311     \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec}.at<\textcolor{keywordtype}{double}>(1) = 0 * 3.141592653589 / 180.0;
1312     \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec}.at<\textcolor{keywordtype}{double}>(2) = -90. * 3.141592653589 / 180.0;
1313 
1314     projectPoints(list\_points3d, \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec}, \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}, \hyperlink{main_8cpp_a53e8957a459b639ca82d938157f3b085}{cameraMatrix}, 
      \hyperlink{main_8cpp_a8d67876da148be9118bba1c0d017fb57}{distCoeffs}, list\_points2dProjected);
1315     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; i++)
1316     \{
1317         circle(cFrame, Point(list\_points2dProjected[i].x, list\_points2dProjected[i].y), 3, Scalar(255, 0, 0
      ), 3);
1318     \}
1319 
1320     \hyperlink{main_8cpp_a2104a5d9d6b9f1e29bc4cd858c59882e}{projectCoordinateFrame}(cFrame);
1321     QPixmap QPFrame;
1322     QPFrame = \hyperlink{main_8cpp_a3e3cc959a7ab6f93ea52863d86373ce5}{Mat2QPixmap}(cFrame);
1323     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.changeImage(QPFrame);
1324     QCoreApplication::processEvents();
1325 
1326 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=328pt]{main_8h_a56c7f641859cb2b6b99b0947d03be800_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=246pt]{main_8h_a56c7f641859cb2b6b99b0947d03be800_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_a2104a5d9d6b9f1e29bc4cd858c59882e}\label{main_8h_a2104a5d9d6b9f1e29bc4cd858c59882e}} 
\index{main.\+h@{main.\+h}!project\+Coordinate\+Frame@{project\+Coordinate\+Frame}}
\index{project\+Coordinate\+Frame@{project\+Coordinate\+Frame}!main.\+h@{main.\+h}}
\subsubsection{\texorpdfstring{project\+Coordinate\+Frame()}{projectCoordinateFrame()}}
{\footnotesize\ttfamily void project\+Coordinate\+Frame (\begin{DoxyParamCaption}\item[{Mat}]{picture\+Frame }\end{DoxyParamCaption})}

Project the coordinate Co\+Sy origin and axis direction of the marker Co\+Sy with the rotation and translation of the object for visualization. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em picture\+Frame} & the image in which the Co\+Sy frame should be pasted. \\
\hline
\end{DoxyParams}


Definition at line 1099 of file main.\+cpp.


\begin{DoxyCode}
1100 \{
1101     projectPoints(\hyperlink{main_8cpp_ab34a04f5429de54d618fe1c9bd363c4e}{coordinateFrame}, \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec}, \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}, 
      \hyperlink{main_8cpp_a53e8957a459b639ca82d938157f3b085}{cameraMatrix}, \hyperlink{main_8cpp_a8d67876da148be9118bba1c0d017fb57}{distCoeffs}, \hyperlink{main_8cpp_a25a0b285905c7882d629b8f561425a2f}{coordinateFrameProjected});
1102     line(pictureFrame, \hyperlink{main_8cpp_a25a0b285905c7882d629b8f561425a2f}{coordinateFrameProjected}[0], 
      \hyperlink{main_8cpp_a25a0b285905c7882d629b8f561425a2f}{coordinateFrameProjected}[3], Scalar(0, 0, 255), 2); \textcolor{comment}{//!<z-axis}
1103 \textcolor{comment}{}    line(pictureFrame, \hyperlink{main_8cpp_a25a0b285905c7882d629b8f561425a2f}{coordinateFrameProjected}[0], 
      \hyperlink{main_8cpp_a25a0b285905c7882d629b8f561425a2f}{coordinateFrameProjected}[1], Scalar(255, 0, 0), 2); \textcolor{comment}{//!<x-axis}
1104 \textcolor{comment}{}    line(pictureFrame, \hyperlink{main_8cpp_a25a0b285905c7882d629b8f561425a2f}{coordinateFrameProjected}[0], 
      \hyperlink{main_8cpp_a25a0b285905c7882d629b8f561425a2f}{coordinateFrameProjected}[2], Scalar(0, 255, 0), 2); \textcolor{comment}{//!<y-axis}
1105 \textcolor{comment}{}\}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{main_8h_a2104a5d9d6b9f1e29bc4cd858c59882e_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_a54b6b6db348b48d21e1265e22829c61f}\label{main_8h_a54b6b6db348b48d21e1265e22829c61f}} 
\index{main.\+h@{main.\+h}!send\+Data\+U\+DP@{send\+Data\+U\+DP}}
\index{send\+Data\+U\+DP@{send\+Data\+U\+DP}!main.\+h@{main.\+h}}
\subsubsection{\texorpdfstring{send\+Data\+U\+D\+P()}{sendDataUDP()}}
{\footnotesize\ttfamily void send\+Data\+U\+DP (\begin{DoxyParamCaption}\item[{cv\+::\+Vec3d \&}]{Position,  }\item[{cv\+::\+Vec3d \&}]{Euler }\end{DoxyParamCaption})}

Send the position and attitude over U\+DP to every receiver, the safety receiver is handled on its own in the start\+Tracking function because its send rate is less than 100 Hz. 

Definition at line 1172 of file main.\+cpp.


\begin{DoxyCode}
1173 \{
1174     \hyperlink{main_8cpp_af38b495bf1b0e0651895215823059d30}{datagram}.clear();
1175     QDataStream out(&\hyperlink{main_8cpp_af38b495bf1b0e0651895215823059d30}{datagram}, QIODevice::WriteOnly);
1176     out.setVersion(QDataStream::Qt\_4\_3);
1177     out << (float)Position[0] << (\textcolor{keywordtype}{float})Position[1] << (float)Position[2];
1178     out << (float)Euler[0] << (\textcolor{keywordtype}{float})Euler[1] << (float)Euler[2]; \textcolor{comment}{//! Roll Pitch Heading}
1179 \textcolor{comment}{}    \hyperlink{main_8cpp_ae628b9aba095776b7134cf188486e174}{udpSocketObject}->writeDatagram(\hyperlink{main_8cpp_af38b495bf1b0e0651895215823059d30}{datagram}, 
      \hyperlink{main_8cpp_ab97ac0d82b1753d0eef37089be17e5e1}{IPAdressObject}, \hyperlink{main_8cpp_a9a00043c93a3362969c1c1fcd3a70fea}{portObject});
1180 \textcolor{comment}{}
1181 \textcolor{comment}{    //! if second receiver is activated send it also the tracking data}
1182 \textcolor{comment}{}    \textcolor{keywordflow}{if} (\hyperlink{main_8cpp_a436fb814ccc3f02617dade4dc6511143}{safety2Enable})
1183     \{
1184         \hyperlink{main_8cpp_a4260e46da4e0e430642b2d8d8d3c7dd1}{udpSocketSafety2}->writeDatagram(\hyperlink{main_8cpp_af38b495bf1b0e0651895215823059d30}{datagram}, 
      \hyperlink{main_8cpp_a354806cf8cbface3575f2541d8fbcbda}{IPAdressSafety2}, \hyperlink{main_8cpp_a2601be9c226be24c71ec8282f632e723}{portSafety2});
1185     \}
1186 
1187 \}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{main_8h_a54b6b6db348b48d21e1265e22829c61f_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_ad19da4e648bbdc80d3123eb94711588e}\label{main_8h_ad19da4e648bbdc80d3123eb94711588e}} 
\index{main.\+h@{main.\+h}!set\+Heading\+Offset@{set\+Heading\+Offset}}
\index{set\+Heading\+Offset@{set\+Heading\+Offset}!main.\+h@{main.\+h}}
\subsubsection{\texorpdfstring{set\+Heading\+Offset()}{setHeadingOffset()}}
{\footnotesize\ttfamily void set\+Heading\+Offset (\begin{DoxyParamCaption}\item[{double}]{d }\end{DoxyParamCaption})}

Add a heading offset to the attitude for the case it is wanted by the user. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em d} & denotes heading offset in degrees. \\
\hline
\end{DoxyParams}


Definition at line 1140 of file main.\+cpp.


\begin{DoxyCode}
1141 \{
1142     \hyperlink{main_8cpp_a377d62efbf6892902616cb71a4a5d5d7}{headingOffset} = d;
1143     d = d * 3.141592653589 / 180.0; \textcolor{comment}{//! Convert heading offset from degrees to rad}
1144 \textcolor{comment}{}\textcolor{comment}{}
1145 \textcolor{comment}{    //! Calculate rotation about x axis}
1146 \textcolor{comment}{}    Mat R\_x = (Mat\_<double>(3, 3) <<
1147         1, 0, 0,
1148         0, 1, 0,
1149         0, 0, 1
1150         );
1151 \textcolor{comment}{}
1152 \textcolor{comment}{    //! Calculate rotation about y axis}
1153 \textcolor{comment}{}    Mat R\_y = (Mat\_<double>(3, 3) <<
1154         1, 0, 0,
1155         0, 1, 0,
1156         0, 0, 1
1157         );
1158 \textcolor{comment}{}
1159 \textcolor{comment}{    //! Calculate rotation about z axis}
1160 \textcolor{comment}{}    Mat R\_z = (Mat\_<double>(3, 3) <<
1161         cos(d), -sin(d), 0,
1162         sin(d), cos(d), 0,
1163         0, 0, 1);
1164 
1165 \textcolor{comment}{}
1166 \textcolor{comment}{    //! Combined rotation matrix}
1167 \textcolor{comment}{}    \hyperlink{main_8cpp_a7b0c222d472eacfd5b0d73ed769baae0}{M\_HeadingOffset} = R\_z * R\_y * R\_x;
1168 \}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=245pt]{main_8h_ad19da4e648bbdc80d3123eb94711588e_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_a1e6662e0f16887fe97c7bebe05065972}\label{main_8h_a1e6662e0f16887fe97c7bebe05065972}} 
\index{main.\+h@{main.\+h}!set\+Reference@{set\+Reference}}
\index{set\+Reference@{set\+Reference}!main.\+h@{main.\+h}}
\subsubsection{\texorpdfstring{set\+Reference()}{setReference()}}
{\footnotesize\ttfamily int set\+Reference (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Determine the initial position of the object that serves as reference point or as ground frame origin. Computes the pose 200 times and then averages it. The position and attitude are from now on used as navigation Co\+Sy. 

Definition at line 613 of file main.\+cpp.


\begin{DoxyCode}
614 \{\textcolor{comment}{}
615 \textcolor{comment}{    //! initialize the variables with starting values}
616 \textcolor{comment}{}    \hyperlink{main_8cpp_acf655f393e3996144226399a338e8d3b}{gotOrder} = \textcolor{keyword}{false};
617     \hyperlink{main_8cpp_a9d2e25dbfda0ebcdbb488652c8b15fad}{posRef} = 0;
618     \hyperlink{main_8cpp_acd6966c004a57c4080ba204152200e7f}{eulerRef} = 0;
619     \hyperlink{main_8cpp_a4ee4d2abbe47b92c21b81c5c4389086e}{RmatRef} = 0;
620     \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec} = \hyperlink{main_8cpp_ae101daeaec726e27690c862b7edea825}{RvecOriginal};
621     \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec} = \hyperlink{main_8cpp_a043bf1deaf5d42d47e0cce8982c1f18b}{TvecOriginal};
622 
623     \hyperlink{main_8cpp_a0416912fce6274568e80019b10ba294f}{determineExposure}();
624 
625     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(\textcolor{stringliteral}{""});
626     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"Started reference coordinate determination."});
627 
628     CameraLibrary\_EnableDevelopment();\textcolor{comment}{}
629 \textcolor{comment}{    //! Initialize Camera SDK ==--}
630 \textcolor{comment}{}    CameraLibrary::CameraManager::X();
631 \textcolor{comment}{}
632 \textcolor{comment}{    //! At this point the Camera SDK is actively looking for all connected cameras and will initialize}
633 \textcolor{comment}{    //! them on it's own.}
634 \textcolor{comment}{}\textcolor{comment}{}
635 \textcolor{comment}{    //! Get a connected camera ================----}
636 \textcolor{comment}{}    CameraManager::X().WaitForInitialization();
637     Camera *camera = CameraManager::X().GetCamera();
638 \textcolor{comment}{}
639 \textcolor{comment}{    //! If no device connected, pop a message box and exit ==--}
640 \textcolor{comment}{}    \textcolor{keywordflow}{if} (camera == 0)
641     \{
642         \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"No camera found!"});
643         \textcolor{keywordflow}{return} 1;
644     \}
645 \textcolor{comment}{}
646 \textcolor{comment}{    //! Determine camera resolution to size application window ==----}
647 \textcolor{comment}{}    \textcolor{keywordtype}{int} cameraWidth = camera->Width();
648     \textcolor{keywordtype}{int} cameraHeight = camera->Height();
649     camera->GetDistortionModel(\hyperlink{main_8cpp_a9fba099569a2da23e458c2571f69652a}{distModel});
650     cv::Mat matFrame(cv::Size(cameraWidth, cameraHeight), CV\_8UC1);
651 \textcolor{comment}{}
652 \textcolor{comment}{    //! Set camera mode to precision mode, it directly provides marker coordinates}
653 \textcolor{comment}{}    camera->SetVideoType(Core::PrecisionMode);
654 \textcolor{comment}{}
655 \textcolor{comment}{    //! Start camera output ==--}
656 \textcolor{comment}{}    camera->Start();
657 \textcolor{comment}{}
658 \textcolor{comment}{    //! Turn on some overlay text so it's clear things are     ===---}
659 \textcolor{comment}{    //! working even if there is nothing in the camera's view. ===---}
660 \textcolor{comment}{    //! Set some other parameters as well of the camera}
661 \textcolor{comment}{}    camera->SetTextOverlay(\textcolor{keyword}{true});
662     camera->SetFrameRate(\hyperlink{main_8cpp_aa5b833b78b107a1a04eb4edba151c0ba}{intFrameRate});
663     camera->SetIntensity(\hyperlink{main_8cpp_a4e18b0b26ecc511ca7d2f2205313e537}{intIntensity});
664     camera->SetIRFilter(\textcolor{keyword}{true});
665     camera->SetContinuousIR(\textcolor{keyword}{false});
666     camera->SetHighPowerMode(\textcolor{keyword}{false});
667 \textcolor{comment}{}
668 \textcolor{comment}{    //! sample some frames and calculate the position and attitude. then average those values and use that
       as zero position}
669 \textcolor{comment}{}    \textcolor{keywordtype}{int} numberSamples = 0;
670     \textcolor{keywordtype}{int} numberToSample = 200;
671     \textcolor{keywordtype}{double} projectionError = 0; \textcolor{comment}{//!< difference between the marker points as seen by the camera and the
       projected marker points with Rvec and Tvec}
672 \textcolor{comment}{}
673     \textcolor{keywordflow}{while} (numberSamples < numberToSample)
674     \{\textcolor{comment}{}
675 \textcolor{comment}{        //! Fetch a new frame from the camera ===---}
676 \textcolor{comment}{}        Frame *frame = camera->GetFrame();
677 
678         \textcolor{keywordflow}{if} (frame)
679         \{\textcolor{comment}{}
680 \textcolor{comment}{            //! Ok, we've received a new frame, lets do something}
681 \textcolor{comment}{            //! with it.}
682 \textcolor{comment}{}            \textcolor{keywordflow}{if} (frame->ObjectCount() == \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers})
683             \{\textcolor{comment}{}
684 \textcolor{comment}{                //!for(int i=0; i<frame->ObjectCount(); i++)}
685 \textcolor{comment}{}                \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; i++)
686                 \{
687                     cObject *obj = frame->Object(i);
688                     \hyperlink{main_8cpp_a54cb682bd037283c18b5a9a447ff5e5e}{list\_points2dUnsorted}[i] = cv::Point2d(obj->X(), obj->Y());
689                 \}
690 
691                 \textcolor{keywordflow}{if} (\hyperlink{main_8cpp_acf655f393e3996144226399a338e8d3b}{gotOrder} == \textcolor{keyword}{false})
692                 \{
693                     \hyperlink{main_8cpp_a11ff459289305229597defd39f510959}{determineOrder}();
694                 \}
695 \textcolor{comment}{}
696 \textcolor{comment}{                //! sort the 2d points with the correct indices as found in the preceeding order
       determination algorithm}
697 \textcolor{comment}{}                \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} w = 0; w < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; w++)
698                 \{
699                     \hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d}[w] = \hyperlink{main_8cpp_a54cb682bd037283c18b5a9a447ff5e5e}{list\_points2dUnsorted}[
      \hyperlink{main_8cpp_ac06fee052099b9fc9f0826315bb64a4a}{pointOrderIndices}[w]];
700                 \}
701                 \hyperlink{main_8cpp_a85d3d8c8a0e3e9cfb6157c247470d934}{list\_points2dOld} = \hyperlink{main_8cpp_a54cb682bd037283c18b5a9a447ff5e5e}{list\_points2dUnsorted};
702 \textcolor{comment}{}
703 \textcolor{comment}{                //!Compute the pose from the 3D-2D corresponses}
704 \textcolor{comment}{}                solvePnP(\hyperlink{main_8cpp_a933edb4ba1c0589d59020164c2f1ff87}{list\_points3d}, \hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d}, 
      \hyperlink{main_8cpp_a53e8957a459b639ca82d938157f3b085}{cameraMatrix}, \hyperlink{main_8cpp_a8d67876da148be9118bba1c0d017fb57}{distCoeffs}, \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec}, \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}, \hyperlink{main_8cpp_ab1cc9be1ff0871bc5de1eb4c2811ae3e}{useGuess}, 
      \hyperlink{main_8cpp_ab5e634b66221f494504aea1557af5df9}{methodPNP});
705 \textcolor{comment}{}
706 \textcolor{comment}{                //! project the marker 3d points with the solution into the camera image CoSy and calculate
       difference to true camera image}
707 \textcolor{comment}{}                projectPoints(\hyperlink{main_8cpp_a933edb4ba1c0589d59020164c2f1ff87}{list\_points3d}, \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec}, \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}, 
      \hyperlink{main_8cpp_a53e8957a459b639ca82d938157f3b085}{cameraMatrix}, \hyperlink{main_8cpp_a8d67876da148be9118bba1c0d017fb57}{distCoeffs}, \hyperlink{main_8cpp_a7b88d0425a68875639d40a17079df819}{list\_points2dProjected});
708                 projectionError = norm(\hyperlink{main_8cpp_a7b88d0425a68875639d40a17079df819}{list\_points2dProjected}, 
      \hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d});
709 
710                 \textcolor{keywordtype}{double} maxValue = 0;
711                 \textcolor{keywordtype}{double} minValue = 0;
712                 minMaxLoc(\hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}.at<\textcolor{keywordtype}{double}>(2), &minValue, &maxValue);
713 
714                 \textcolor{keywordflow}{if} (maxValue > 10000 || minValue < 0)
715                 \{
716                     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(\textcolor{stringliteral}{""});
717                     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"Negative z distance, thats not possible. Start the set zero routine again or
       restart Programm."};
718                     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(QString::fromStdString(\hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str()));
719                     frame->Release();
720                     \textcolor{keywordflow}{return} 1;
721                 \}
722 
723                 \textcolor{keywordflow}{if} (projectionError > 5)
724                 \{
725                     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"Reprojection error is bigger than 5 pixel. Correct marker
       configuration loaded?\(\backslash\)nMarker position measured precisely?"});
726                     frame->Release();
727                     \textcolor{keywordflow}{return} 1;
728                 \}
729 
730                 \textcolor{keywordflow}{if} (norm(\hyperlink{main_8cpp_a1d543a183197268bcb54a06bf157852c}{positionOld}) - norm(\hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}) < 0.05)   \textcolor{comment}{//!<Iterative Method needs time
       to converge to solution}
731 \textcolor{comment}{}                \{
732                     add(\hyperlink{main_8cpp_a9d2e25dbfda0ebcdbb488652c8b15fad}{posRef}, \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}, \hyperlink{main_8cpp_a9d2e25dbfda0ebcdbb488652c8b15fad}{posRef});
733                     add(\hyperlink{main_8cpp_acd6966c004a57c4080ba204152200e7f}{eulerRef}, \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec}, \hyperlink{main_8cpp_acd6966c004a57c4080ba204152200e7f}{eulerRef}); \textcolor{comment}{//!< That are not the values of yaw,
       roll and pitch yet! Rodriguez has to be called first. }
734 \textcolor{comment}{}                    numberSamples++;    \textcolor{comment}{//!<  one sample more :D}
735 \textcolor{comment}{}                    \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.progressUpdate(numberSamples * 100 / numberToSample);
736                 \}
737                 \hyperlink{main_8cpp_a1d543a183197268bcb54a06bf157852c}{positionOld} = \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec};
738 
739                 Mat cFrame(480, 640, CV\_8UC3, Scalar(0, 0, 0));
740                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; i++)
741                 \{
742                     circle(cFrame, Point(\hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d}[i].x, 
      \hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d}[i].y), 6, Scalar(0, 225, 0), 3);
743                 \}
744                 \hyperlink{main_8cpp_a2104a5d9d6b9f1e29bc4cd858c59882e}{projectCoordinateFrame}(cFrame);
745                 projectPoints(\hyperlink{main_8cpp_a933edb4ba1c0589d59020164c2f1ff87}{list\_points3d}, \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec}, \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}, 
      \hyperlink{main_8cpp_a53e8957a459b639ca82d938157f3b085}{cameraMatrix}, \hyperlink{main_8cpp_a8d67876da148be9118bba1c0d017fb57}{distCoeffs}, \hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d});
746                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; i++)
747                 \{
748                     circle(cFrame, Point(\hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d}[i].x, 
      \hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d}[i].y), 3, Scalar(225, 0, 0), 3);
749                 \}
750                 \hyperlink{main_8cpp_af6430ad2592a955a3618549547dfc5be}{drawPositionText}(cFrame, \hyperlink{main_8cpp_ac6dab448fd1f9b3aed1205fbd8179f5d}{position}, 
      \hyperlink{main_8cpp_a0a53d01e06c71d6360afcb0fabf2aa8e}{eulerAngles}, projectionError);
751 
752                 QPixmap QPFrame;
753                 QPFrame = \hyperlink{main_8cpp_a3e3cc959a7ab6f93ea52863d86373ce5}{Mat2QPixmap}(cFrame);
754                 \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.changeImage(QPFrame);
755                 QCoreApplication::processEvents();
756 
757             \}
758             frame->Release();
759         \}
760     \}\textcolor{comment}{}
761 \textcolor{comment}{    //! Release camera ==--}
762 \textcolor{comment}{}    camera->Release();
763 \textcolor{comment}{}
764 \textcolor{comment}{    //!Divide by the number of samples to get the mean of the reference position}
765 \textcolor{comment}{}    divide(\hyperlink{main_8cpp_a9d2e25dbfda0ebcdbb488652c8b15fad}{posRef}, numberToSample, \hyperlink{main_8cpp_a9d2e25dbfda0ebcdbb488652c8b15fad}{posRef});
766     divide(\hyperlink{main_8cpp_acd6966c004a57c4080ba204152200e7f}{eulerRef}, numberToSample, \hyperlink{main_8cpp_acd6966c004a57c4080ba204152200e7f}{eulerRef}); \textcolor{comment}{//!< eulerRef is here in Axis Angle
       notation}
767 \textcolor{comment}{}
768     Rodrigues(\hyperlink{main_8cpp_acd6966c004a57c4080ba204152200e7f}{eulerRef}, \hyperlink{main_8cpp_a4ee4d2abbe47b92c21b81c5c4389086e}{RmatRef});                \textcolor{comment}{//!< axis angle to rotation matrix}
769 \textcolor{comment}{}\textcolor{comment}{    //!-- Euler Angles, finally }
770 \textcolor{comment}{}    \hyperlink{main_8cpp_ab2b71933055cf32cc8e5e2100fd7723f}{getEulerAngles}(\hyperlink{main_8cpp_a4ee4d2abbe47b92c21b81c5c4389086e}{RmatRef}, \hyperlink{main_8cpp_acd6966c004a57c4080ba204152200e7f}{eulerRef}); \textcolor{comment}{//!<  rotation matrix to euler}
771 \textcolor{comment}{}    \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(\textcolor{stringliteral}{""});
772     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"RmatRef is:\(\backslash\)n"};
773     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \hyperlink{main_8cpp_a4ee4d2abbe47b92c21b81c5c4389086e}{RmatRef} << \textcolor{stringliteral}{"\(\backslash\)n"};
774     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"Reference Position is:\(\backslash\)n"};
775     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \hyperlink{main_8cpp_a9d2e25dbfda0ebcdbb488652c8b15fad}{posRef} << \textcolor{stringliteral}{"[mm] \(\backslash\)n"};
776     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"Reference Euler Angles are:\(\backslash\)n"};
777     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \hyperlink{main_8cpp_acd6966c004a57c4080ba204152200e7f}{eulerRef} << \textcolor{stringliteral}{"[deg] \(\backslash\)n"};
778 \textcolor{comment}{}
779 \textcolor{comment}{    //! compute the difference between last obtained TVec and the average Value}
780 \textcolor{comment}{    //! When it is large the iterative method has not converged properly so it is advised to start the
       setReference() function once again}
781 \textcolor{comment}{}    \textcolor{keywordtype}{double} error = norm(posRef) - norm(\hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec});
782     \textcolor{keywordflow}{if} (error > 5.0)
783     \{
784         \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"Caution, distance between reference position and last position is: "} << error << \textcolor{stringliteral}{"\(\backslash\)n Start
       the set zero routine once again."};
785     \}
786     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(QString::fromStdString(\hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str()));
787     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.progressUpdate(0);
788     \textcolor{keywordflow}{return} 0;
789 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=310pt]{main_8h_a1e6662e0f16887fe97c7bebe05065972_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_a3d3afd29ce54eb7fc5cc7e74ab666586}\label{main_8h_a3d3afd29ce54eb7fc5cc7e74ab666586}} 
\index{main.\+h@{main.\+h}!start\+Tracking@{start\+Tracking}}
\index{start\+Tracking@{start\+Tracking}!main.\+h@{main.\+h}}
\subsubsection{\texorpdfstring{start\+Tracking()}{startTracking()}}
{\footnotesize\ttfamily int start\+Tracking (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Start the loop that fetches frames, computes the position etc and sends it to other computers. This function is the core of this program, hence the pose estimation is done here. 

Definition at line 276 of file main.\+cpp.


\begin{DoxyCode}
276                     \{
277 
278 
279     \hyperlink{main_8cpp_acf655f393e3996144226399a338e8d3b}{gotOrder} = \textcolor{keyword}{false}; \textcolor{comment}{//! The order of points, hence which entry in list\_points3d corresponds to
       which in list\_points2d is not calculated yet}
280 \textcolor{comment}{}    \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec} = \hyperlink{main_8cpp_ae101daeaec726e27690c862b7edea825}{RvecOriginal}; \textcolor{comment}{//! Use the value of Rvec that was set in main() as starting value
       for the solvePnP algorithm}
281 \textcolor{comment}{}    \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec} = \hyperlink{main_8cpp_a043bf1deaf5d42d47e0cce8982c1f18b}{TvecOriginal}; \textcolor{comment}{//! Use the value of Tvec that was set in main() as starting value
       for the solvePnP algorithm}
282 \textcolor{comment}{}    GetLocalTime(&\hyperlink{main_8cpp_aba7ea4b1074abf42199ab9ab295e9c33}{logDate});  \textcolor{comment}{//! Get the current date and time to name the log file}
283 \textcolor{comment}{}\textcolor{comment}{}
284 \textcolor{comment}{    //! Concat the log file name as followed. The file is saved in the folder /logs in the Rigid Track
       installation folder}
285 \textcolor{comment}{}    \hyperlink{main_8cpp_a10895c5c32e9441213c79f05d2b5ba45}{logFileName} = \textcolor{stringliteral}{"./logs/positionLog\_"} + QString::number(\hyperlink{main_8cpp_aba7ea4b1074abf42199ab9ab295e9c33}{logDate}.wDay) + \textcolor{stringliteral}{"\_"} + 
      QString::number(\hyperlink{main_8cpp_aba7ea4b1074abf42199ab9ab295e9c33}{logDate}.wMonth) + \textcolor{stringliteral}{"\_"} + QString::number(\hyperlink{main_8cpp_aba7ea4b1074abf42199ab9ab295e9c33}{logDate}.wYear);
286     \hyperlink{main_8cpp_a10895c5c32e9441213c79f05d2b5ba45}{logFileName} += \textcolor{stringliteral}{"\_"} + QString::number(\hyperlink{main_8cpp_aba7ea4b1074abf42199ab9ab295e9c33}{logDate}.wHour) + \textcolor{stringliteral}{"\_"} + QString::number(
      \hyperlink{main_8cpp_aba7ea4b1074abf42199ab9ab295e9c33}{logDate}.wMinute) + \textcolor{stringliteral}{"\_"} + QString::number(\hyperlink{main_8cpp_aba7ea4b1074abf42199ab9ab295e9c33}{logDate}.wSecond) + \textcolor{stringliteral}{".txt"};
287     \hyperlink{main_8cpp_a7a642b2c947e62ff5ec692ec95783bd0}{logName} = \hyperlink{main_8cpp_a10895c5c32e9441213c79f05d2b5ba45}{logFileName}.toStdString(); \textcolor{comment}{//! Convert the QString to a standard string}
288 \textcolor{comment}{}
289     \hyperlink{main_8cpp_a0416912fce6274568e80019b10ba294f}{determineExposure}(); \textcolor{comment}{//! Get the exposure where the right amount of markers is
       detected}
290 \textcolor{comment}{}\textcolor{comment}{}
291 \textcolor{comment}{    //! For OptiTrack Ethernet cameras, it's important to enable development mode if you}
292 \textcolor{comment}{    //! want to stop execution for an extended time while debugging without disconnecting}
293 \textcolor{comment}{    //! the Ethernet devices.  Lets do that now:}
294 \textcolor{comment}{}
295     CameraLibrary\_EnableDevelopment();
296     CameraLibrary::CameraManager::X(); \textcolor{comment}{//! Initialize Camera SDK}
297 \textcolor{comment}{}\textcolor{comment}{}
298 \textcolor{comment}{    //! At this point the Camera SDK is actively looking for all connected cameras and will initialize}
299 \textcolor{comment}{    //! them on it's own}
300 \textcolor{comment}{}\textcolor{comment}{}
301 \textcolor{comment}{    //! Get a connected camera}
302 \textcolor{comment}{}    CameraManager::X().WaitForInitialization();
303     Camera *camera = CameraManager::X().GetCamera();
304 \textcolor{comment}{}
305 \textcolor{comment}{    //! If no camera can be found, inform user in message log and exit function}
306 \textcolor{comment}{}    \textcolor{keywordflow}{if} (camera == 0)
307     \{
308         \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"No camera found!"});
309         \textcolor{keywordflow}{return} 1;
310     \}
311 \textcolor{comment}{}
312 \textcolor{comment}{    //! Determine camera resolution to size application window }
313 \textcolor{comment}{}    \textcolor{keywordtype}{int} cameraWidth = camera->Width();
314     \textcolor{keywordtype}{int} cameraHeight = camera->Height();
315 
316     camera->SetVideoType(Core::PrecisionMode);  \textcolor{comment}{//! Set the camera mode to precision mode, it used
       greyscale imformation for marker property calculations}
317 \textcolor{comment}{}
318     camera->Start(); \textcolor{comment}{//! Start camera output}
319 \textcolor{comment}{}\textcolor{comment}{}
320 \textcolor{comment}{    //! Turn on some overlay text so it's clear things are}
321 \textcolor{comment}{    //! working even if there is nothing in the camera's view}
322 \textcolor{comment}{}    camera->SetTextOverlay(\textcolor{keyword}{true});
323     camera->SetExposure(\hyperlink{main_8cpp_afcaebd6cfd12b2e558363a06db8396ea}{intExposure});    \textcolor{comment}{//! Set the camera exposure}
324 \textcolor{comment}{}    camera->SetIntensity(\hyperlink{main_8cpp_a4e18b0b26ecc511ca7d2f2205313e537}{intIntensity}); \textcolor{comment}{//! Set the camera infrared LED intensity}
325 \textcolor{comment}{}    camera->SetFrameRate(\hyperlink{main_8cpp_aa5b833b78b107a1a04eb4edba151c0ba}{intFrameRate}); \textcolor{comment}{//! Set the camera framerate to 100 Hz}
326 \textcolor{comment}{}    camera->SetIRFilter(\textcolor{keyword}{true});  \textcolor{comment}{//! Enable the filter that blocks visible light and only passes infrared
       light}
327 \textcolor{comment}{}    camera->SetHighPowerMode(\textcolor{keyword}{true}); \textcolor{comment}{//! Enable high power mode of the LEDs}
328 \textcolor{comment}{}    camera->SetContinuousIR(\textcolor{keyword}{false}); \textcolor{comment}{//! Disable continuous LED light}
329 \textcolor{comment}{}    camera->SetThreshold(\hyperlink{main_8cpp_ac61559ce6020b8ec00161bc3a994ddcc}{intThreshold}); \textcolor{comment}{//! Set threshold for marker detection}
330 \textcolor{comment}{}\textcolor{comment}{}
331 \textcolor{comment}{    //! Create a new matrix that stores the grayscale picture from the camera}
332 \textcolor{comment}{}    Mat matFrame = Mat::zeros(cv::Size(cameraWidth, cameraHeight), CV\_8UC1);
333     QPixmap QPFrame; \textcolor{comment}{//! QPixmap is the corresponding Qt class that saves images}
334 \textcolor{comment}{}\textcolor{comment}{    //! Matrix that stores the colored picture, hence marker points, coordinate frame and reprojected
       points}
335 \textcolor{comment}{}    Mat cFrame(480, 640, CV\_8UC3, Scalar(0, 0, 0));
336 
337     \textcolor{keywordtype}{int} v = 0;  \textcolor{comment}{//! Helper variable used to kick safety switch}
338 \textcolor{comment}{}\textcolor{comment}{    //! Variables for the min and max values that are needed for sanity checks}
339 \textcolor{comment}{}    \textcolor{keywordtype}{double} maxValue = 0;
340     \textcolor{keywordtype}{double} minValue = 0;
341     \textcolor{keywordtype}{int} framesDropped = 0; \textcolor{comment}{//! Ff a marker is not visible or accuracy is bad increase this counter}
342 \textcolor{comment}{}    \textcolor{keywordtype}{double} projectionError = 0; \textcolor{comment}{//! Equals the quality of the tracking}
343 \textcolor{comment}{}
344     \hyperlink{main_8cpp_ae624b0189bc5e32cbbb1f178b9f1a360}{setUpUDP}(); \textcolor{comment}{//! Open sockets and ports for UDP communication}
345 \textcolor{comment}{}
346     \textcolor{keywordflow}{if} (\hyperlink{main_8cpp_aa6266eedab8b3c011be53baffbfc42ab}{safetyEnable}) \textcolor{comment}{//! If the safety feature is enabled send the starting message}
347 \textcolor{comment}{}    \{\textcolor{comment}{}
348 \textcolor{comment}{        //! Send enable message, hence send a 9 and then a 1 }
349 \textcolor{comment}{}        \hyperlink{main_8cpp_ad44c6ce322034044d573e6d4678d630b}{data}.setNum((\textcolor{keywordtype}{int})(9));
350         \hyperlink{main_8cpp_a6aa0c3a69dc10d5c4432dcf62e2155d3}{udpSocketSafety}->write(\hyperlink{main_8cpp_ad44c6ce322034044d573e6d4678d630b}{data});
351         \hyperlink{main_8cpp_ad44c6ce322034044d573e6d4678d630b}{data}.setNum((\textcolor{keywordtype}{int})(1));
352         \hyperlink{main_8cpp_a6aa0c3a69dc10d5c4432dcf62e2155d3}{udpSocketSafety}->write(\hyperlink{main_8cpp_ad44c6ce322034044d573e6d4678d630b}{data});
353     \}
354 \textcolor{comment}{}
355 \textcolor{comment}{    //! Fetch a new frame from the camera}
356 \textcolor{comment}{}    \textcolor{keywordtype}{bool} gotTime = \textcolor{keyword}{false}; \textcolor{comment}{//! Get the timestamp of the first frame. This time is subtracted from every
       subseeding frame so the time starts at 0 in the logs}
357 \textcolor{comment}{}    \textcolor{keywordflow}{while} (!gotTime) \textcolor{comment}{//! While no new frame is received loop }
358 \textcolor{comment}{}    \{
359         Frame *frame = camera->GetFrame(); \textcolor{comment}{//! Get a new camera frame}
360 \textcolor{comment}{}        \textcolor{keywordflow}{if} (frame)  \textcolor{comment}{//! There is actually a new frame}
361 \textcolor{comment}{}        \{
362             \hyperlink{main_8cpp_ac7de3790df75e7d70bfe280b9af47a56}{timeFirstFrame} = frame->TimeStamp(); \textcolor{comment}{//! Get the time stamp for the first frame.
       It is subtracted for the following frames}
363 \textcolor{comment}{}            frame->Release();   \textcolor{comment}{//! Release the frame so the camera can continue}
364 \textcolor{comment}{}            gotTime = \textcolor{keyword}{true}; \textcolor{comment}{//! Exit the while loop}
365 \textcolor{comment}{}        \}
366     \}
367 \textcolor{comment}{}
368 \textcolor{comment}{    //! Now enter the main loop that processes each frame and computes the pose, sends it and logs stuff}
369 \textcolor{comment}{}    \textcolor{keywordflow}{while} (!\hyperlink{main_8cpp_a6b1342fd3f76c3ce13245825cff8e400}{exitRequested}) \textcolor{comment}{//! Check if the user has not pressed "Stop Tracking" yet}
370 \textcolor{comment}{}    \{
371 
372         Frame *frame = camera->GetFrame(); \textcolor{comment}{//! Fetch a new frame from the camera}
373 \textcolor{comment}{}
374         \textcolor{keywordflow}{if} (frame) \textcolor{comment}{//! Did we got a new frame or does the camera still need more time}
375 \textcolor{comment}{}        \{
376             framesDropped++; \textcolor{comment}{//! Increase by one, if everything is okay it is decreased at the end of the
       loop again}
377 \textcolor{comment}{}\textcolor{comment}{}
378 \textcolor{comment}{            //! Only use this frame it the right number of markers is found in the picture}
379 \textcolor{comment}{}            \textcolor{keywordflow}{if} (frame->ObjectCount() == \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers})
380             \{\textcolor{comment}{}
381 \textcolor{comment}{                //! Get the marker points in 2D in the camera image frame and store them in the
       list\_points2dUnsorted vector}
382 \textcolor{comment}{                //! The order of points that come from the camera corresponds to the Y coordinate}
383 \textcolor{comment}{}                \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; i++)
384                 \{
385                     cObject *obj = frame->Object(i);
386                     \hyperlink{main_8cpp_a54cb682bd037283c18b5a9a447ff5e5e}{list\_points2dUnsorted}[i] = cv::Point2d(obj->X(), obj->Y());
387                 \}
388 
389                 \textcolor{keywordflow}{if} (\hyperlink{main_8cpp_acf655f393e3996144226399a338e8d3b}{gotOrder} == \textcolor{keyword}{false}) \textcolor{comment}{//! Was the order already determined? This is false for the
       first frame and from then on true}
390 \textcolor{comment}{}                \{
391                     \hyperlink{main_8cpp_a11ff459289305229597defd39f510959}{determineOrder}(); \textcolor{comment}{//! Now compute the order}
392 \textcolor{comment}{}                \}
393 \textcolor{comment}{}
394 \textcolor{comment}{                //! Sort the 2d points with the correct indices as found in the preceeding order
       determination algorithm}
395 \textcolor{comment}{}                \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} w = 0; w < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; w++)
396                 \{
397                     \hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d}[w] = \hyperlink{main_8cpp_a54cb682bd037283c18b5a9a447ff5e5e}{list\_points2dUnsorted}[
      \hyperlink{main_8cpp_ac06fee052099b9fc9f0826315bb64a4a}{pointOrderIndices}[w]]; \textcolor{comment}{//! pointOrderIndices was calculated in determineOrder()}
398 \textcolor{comment}{}                \}
399 \textcolor{comment}{}
400 \textcolor{comment}{                //! The first time the 2D-3D corresspondence was determined with gotOrder was okay. }
401 \textcolor{comment}{                //! But this order can change as the object moves and the marker objects appear in a}
402 \textcolor{comment}{                //! different order in the frame->Object() array.}
403 \textcolor{comment}{                //! The solution is that: When a marker point (in the camera image, hence in 2D) was at}
404 \textcolor{comment}{                //! a position then it wont move that much from one frame to the other.}
405 \textcolor{comment}{                //! So for the new frame we take a marker object and check which marker was closest this
       point  }
406 \textcolor{comment}{                //! in the old image frame? This is probably the same (true) marker. And we do that for
       every other marker as well.}
407 \textcolor{comment}{                //! When tracking is good and no frames are dropped because of missing markers this should
       work every frame.}
408 \textcolor{comment}{}                \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; j++)
409                 \{
410                     \hyperlink{main_8cpp_ab826a7ca5876afdd6c0bccf04b73b30b}{minPointDistance} = 5000; \textcolor{comment}{//! The sum of point distances is set to
       something unrealistic large}
411 \textcolor{comment}{}                    \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; k++)
412                     \{\textcolor{comment}{}
413 \textcolor{comment}{                        //! Calculate N\_2 norm of unsorted points minus old points}
414 \textcolor{comment}{}                        \hyperlink{main_8cpp_afe37bd67ad83a2d897cf5977cba70ef3}{currentPointDistance} = norm(
      \hyperlink{main_8cpp_a54cb682bd037283c18b5a9a447ff5e5e}{list\_points2dUnsorted}[\hyperlink{main_8cpp_ac06fee052099b9fc9f0826315bb64a4a}{pointOrderIndices}[j]] - 
      \hyperlink{main_8cpp_a85d3d8c8a0e3e9cfb6157c247470d934}{list\_points2dOld}[k]);\textcolor{comment}{}
415 \textcolor{comment}{                        //! If the norm is smaller than minPointDistance the correspondence is more likely
       to be correct}
416 \textcolor{comment}{}                        \textcolor{keywordflow}{if} (\hyperlink{main_8cpp_afe37bd67ad83a2d897cf5977cba70ef3}{currentPointDistance} < 
      \hyperlink{main_8cpp_ab826a7ca5876afdd6c0bccf04b73b30b}{minPointDistance})
417                         \{\textcolor{comment}{}
418 \textcolor{comment}{                            //! Update the array that saves the new point order}
419 \textcolor{comment}{}                            \hyperlink{main_8cpp_ab826a7ca5876afdd6c0bccf04b73b30b}{minPointDistance} = 
      \hyperlink{main_8cpp_afe37bd67ad83a2d897cf5977cba70ef3}{currentPointDistance};
420                             \hyperlink{main_8cpp_acc9e758efd664582db86f976cec195fa}{pointOrderIndicesNew}[j] = k;
421                         \}
422                     \}
423                 \}
424 \textcolor{comment}{}
425 \textcolor{comment}{                //! Now the new order is found, set the point order to the new value}
426 \textcolor{comment}{}                \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; k++)
427                 \{
428                     \hyperlink{main_8cpp_ac06fee052099b9fc9f0826315bb64a4a}{pointOrderIndices}[k] = \hyperlink{main_8cpp_acc9e758efd664582db86f976cec195fa}{pointOrderIndicesNew}[k];
429                     \hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d}[k] = \hyperlink{main_8cpp_a54cb682bd037283c18b5a9a447ff5e5e}{list\_points2dUnsorted}[
      \hyperlink{main_8cpp_ac06fee052099b9fc9f0826315bb64a4a}{pointOrderIndices}[k]];
430                 \}
431 \textcolor{comment}{}
432 \textcolor{comment}{                //! Save the unsorted position of the marker points for the next loop}
433 \textcolor{comment}{}                \hyperlink{main_8cpp_a85d3d8c8a0e3e9cfb6157c247470d934}{list\_points2dOld} = \hyperlink{main_8cpp_a54cb682bd037283c18b5a9a447ff5e5e}{list\_points2dUnsorted};
434 \textcolor{comment}{}
435 \textcolor{comment}{                //!Compute the object pose from the 3D-2D corresponses}
436 \textcolor{comment}{}                solvePnP(\hyperlink{main_8cpp_a933edb4ba1c0589d59020164c2f1ff87}{list\_points3d}, \hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d}, 
      \hyperlink{main_8cpp_a53e8957a459b639ca82d938157f3b085}{cameraMatrix}, \hyperlink{main_8cpp_a8d67876da148be9118bba1c0d017fb57}{distCoeffs}, \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec}, \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}, \hyperlink{main_8cpp_ab1cc9be1ff0871bc5de1eb4c2811ae3e}{useGuess}, 
      \hyperlink{main_8cpp_ab5e634b66221f494504aea1557af5df9}{methodPNP});
437 \textcolor{comment}{}
438 \textcolor{comment}{                //! Project the marker 3d points with the solution into the camera image CoSy and calculate
       difference to true camera image}
439 \textcolor{comment}{}                projectPoints(\hyperlink{main_8cpp_a933edb4ba1c0589d59020164c2f1ff87}{list\_points3d}, \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec}, \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}, 
      \hyperlink{main_8cpp_a53e8957a459b639ca82d938157f3b085}{cameraMatrix}, \hyperlink{main_8cpp_a8d67876da148be9118bba1c0d017fb57}{distCoeffs}, \hyperlink{main_8cpp_a7b88d0425a68875639d40a17079df819}{list\_points2dProjected});
440                 projectionError = norm(\hyperlink{main_8cpp_a7b88d0425a68875639d40a17079df819}{list\_points2dProjected}, 
      \hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d}); \textcolor{comment}{//! Difference of true pose and found pose}
441 \textcolor{comment}{}\textcolor{comment}{}
442 \textcolor{comment}{                //! Increase the framesDropped variable if accuracy of tracking is too bad}
443 \textcolor{comment}{}                \textcolor{keywordflow}{if} (projectionError > 5)
444                 \{
445                     framesDropped++;
446                 \}
447                 \textcolor{keywordflow}{else}
448                 \{
449                     framesDropped = 0;  \textcolor{comment}{//! Set number of subsequent frames dropped to zero because error
       is small enough and no marker was missing}
450 \textcolor{comment}{}                \}
451 \textcolor{comment}{}
452 \textcolor{comment}{                //! Get the min and max values from TVec for sanity check}
453 \textcolor{comment}{}                minMaxLoc(\hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}.at<\textcolor{keywordtype}{double}>(2), &minValue, &maxValue);
454 \textcolor{comment}{}
455 \textcolor{comment}{                //! Sanity check of values. negative z means the marker CoSy is behind the camera, that's
       not possible.}
456 \textcolor{comment}{}                \textcolor{keywordflow}{if} (minValue < 0)
457                 \{
458                     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"Negative z distance, that is not possible. Start the set zero
       routine again or restart Program."});
459                     frame->Release(); \textcolor{comment}{//! Release the frame so the camera can move on}
460 \textcolor{comment}{}                    camera->Release(); \textcolor{comment}{//! Release the camera}
461 \textcolor{comment}{}                    \hyperlink{main_8cpp_af2a8b7de0b15dc17198c147ba39e85f3}{closeUDP}(); \textcolor{comment}{//! Close all UDP connections so the programm can be closed later
       on and no resources are locked}
462 \textcolor{comment}{}                    \textcolor{keywordflow}{return} 1; \textcolor{comment}{//! Exit the function}
463 \textcolor{comment}{}                \}
464 \textcolor{comment}{}
465 \textcolor{comment}{                //! Next step is the transformation from camera CoSy to navigation CoSy}
466 \textcolor{comment}{                //! Compute the relative object position from the reference position to the current one}
467 \textcolor{comment}{                //! given in the camera CoSy: \(\backslash\)f$ T\_C^\{NM\} = Tvec - Tvec\_\{Ref\} \(\backslash\)f$}
468 \textcolor{comment}{}                subtract(\hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}, \hyperlink{main_8cpp_a9d2e25dbfda0ebcdbb488652c8b15fad}{posRef}, \hyperlink{main_8cpp_ac6dab448fd1f9b3aed1205fbd8179f5d}{position});
469 \textcolor{comment}{}
470 \textcolor{comment}{                //! Transform the position from the camera CoSy to the navigation CoSy with INS alligned
       heading and convert from [mm] to [m]}
471 \textcolor{comment}{                //! \(\backslash\)f$ T\_N^\{NM\} = M\_\{NC\} \(\backslash\)times T\_C^\{NM\} \(\backslash\)f$}
472 \textcolor{comment}{}                Mat V = 0.001 * \hyperlink{main_8cpp_a7b0c222d472eacfd5b0d73ed769baae0}{M\_HeadingOffset} * \hyperlink{main_8cpp_af604b9538ec8923428a78439eaf55f8e}{M\_CN}.t() * (Mat)
      \hyperlink{main_8cpp_ac6dab448fd1f9b3aed1205fbd8179f5d}{position};
473                 \hyperlink{main_8cpp_ac6dab448fd1f9b3aed1205fbd8179f5d}{position} = V;   \textcolor{comment}{//! Position is the result of the preceeding calculation }
474 \textcolor{comment}{}                \hyperlink{main_8cpp_ac6dab448fd1f9b3aed1205fbd8179f5d}{position}[2] *= \hyperlink{main_8cpp_a5cc3bd09f5801804b7ae65846e0b9824}{invertZ};  \textcolor{comment}{//! Invert Z if check box in GUI is activated,
       hence height above ground is considered}
475 \textcolor{comment}{}\textcolor{comment}{}
476 \textcolor{comment}{                //! Realtive angle between reference orientation and current orientation}
477 \textcolor{comment}{}                Rodrigues(\hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec}, \hyperlink{main_8cpp_adb13e6a4e95f0640adf01ada840748d9}{Rmat});  \textcolor{comment}{//! Convert axis angle respresentation to ordinary rotation
       matrix}
478 \textcolor{comment}{}\textcolor{comment}{}
479 \textcolor{comment}{                //! The difference of the reference rotation and the current rotation}
480 \textcolor{comment}{                //! \(\backslash\)f$ R\_\{ NM \} = M\_\{ NC \} \(\backslash\)times R\_\{ CM \} \(\backslash\)f$}
481 \textcolor{comment}{}                \hyperlink{main_8cpp_adb13e6a4e95f0640adf01ada840748d9}{Rmat} = \hyperlink{main_8cpp_a4ee4d2abbe47b92c21b81c5c4389086e}{RmatRef}.t() *\hyperlink{main_8cpp_adb13e6a4e95f0640adf01ada840748d9}{Rmat};
482 \textcolor{comment}{}
483 \textcolor{comment}{                //! Euler Angles, finally }
484 \textcolor{comment}{}                \hyperlink{main_8cpp_ab2b71933055cf32cc8e5e2100fd7723f}{getEulerAngles}(\hyperlink{main_8cpp_adb13e6a4e95f0640adf01ada840748d9}{Rmat}, \hyperlink{main_8cpp_a0a53d01e06c71d6360afcb0fabf2aa8e}{eulerAngles}); \textcolor{comment}{//! Get the euler angles
       from the rotation matrix }
485 \textcolor{comment}{}                \hyperlink{main_8cpp_a0a53d01e06c71d6360afcb0fabf2aa8e}{eulerAngles}[2] += \hyperlink{main_8cpp_a377d62efbf6892902616cb71a4a5d5d7}{headingOffset}; \textcolor{comment}{//! Add the heading offset to the
       heading angle}
486 \textcolor{comment}{}\textcolor{comment}{}
487 \textcolor{comment}{                //! Compute the velocity with finite differences. Only use is the log file. It is done here
       because the more precise time stamp can be used}
488 \textcolor{comment}{}                \hyperlink{main_8cpp_ada7a8f4e3e45f929a512ffb0d9ff9012}{frameTime} = frame->TimeStamp() - \hyperlink{main_8cpp_acf4e0d12f76439e42c1ce9fd3d2bcbc8}{timeOld};   \textcolor{comment}{//! Time between the old frame
       and the current frame}
489 \textcolor{comment}{}                \hyperlink{main_8cpp_acf4e0d12f76439e42c1ce9fd3d2bcbc8}{timeOld} = frame->TimeStamp();    \textcolor{comment}{//! Set the old frame time to the current  one}
490 \textcolor{comment}{}                \hyperlink{main_8cpp_a700b8df52e2beb702d06651ed6130e73}{velocity}[0] = (\hyperlink{main_8cpp_ac6dab448fd1f9b3aed1205fbd8179f5d}{position}[0] - \hyperlink{main_8cpp_a1d543a183197268bcb54a06bf157852c}{positionOld}[0]) / 
      \hyperlink{main_8cpp_ada7a8f4e3e45f929a512ffb0d9ff9012}{frameTime}; \textcolor{comment}{//! Calculate the x velocity with finite differences}
491 \textcolor{comment}{}                \hyperlink{main_8cpp_a700b8df52e2beb702d06651ed6130e73}{velocity}[1] = (\hyperlink{main_8cpp_ac6dab448fd1f9b3aed1205fbd8179f5d}{position}[1] - \hyperlink{main_8cpp_a1d543a183197268bcb54a06bf157852c}{positionOld}[1]) / 
      \hyperlink{main_8cpp_ada7a8f4e3e45f929a512ffb0d9ff9012}{frameTime}; \textcolor{comment}{//! Calculate the y velocity with finite differences}
492 \textcolor{comment}{}                \hyperlink{main_8cpp_a700b8df52e2beb702d06651ed6130e73}{velocity}[2] = (\hyperlink{main_8cpp_ac6dab448fd1f9b3aed1205fbd8179f5d}{position}[2] - \hyperlink{main_8cpp_a1d543a183197268bcb54a06bf157852c}{positionOld}[2]) / 
      \hyperlink{main_8cpp_ada7a8f4e3e45f929a512ffb0d9ff9012}{frameTime}; \textcolor{comment}{//! Calculate the z velocity with finite differences}
493 \textcolor{comment}{}                \hyperlink{main_8cpp_a1d543a183197268bcb54a06bf157852c}{positionOld} = \hyperlink{main_8cpp_ac6dab448fd1f9b3aed1205fbd8179f5d}{position};  \textcolor{comment}{//! Set the old position to the current one for
       next frame velocity calcuation}
494 \textcolor{comment}{}
495                 \hyperlink{main_8cpp_a0a53d01e06c71d6360afcb0fabf2aa8e}{eulerAngles}[0] = \hyperlink{main_8cpp_a0a53d01e06c71d6360afcb0fabf2aa8e}{eulerAngles}[0] * -3.141592653589 / 180.0; \textcolor{comment}{//!
       Convert the Euler angles from degrees to rad}
496 \textcolor{comment}{}                \hyperlink{main_8cpp_a0a53d01e06c71d6360afcb0fabf2aa8e}{eulerAngles}[1] = \hyperlink{main_8cpp_a0a53d01e06c71d6360afcb0fabf2aa8e}{eulerAngles}[1] * -3.141592653589 / 180.0;
497                 \hyperlink{main_8cpp_a0a53d01e06c71d6360afcb0fabf2aa8e}{eulerAngles}[2] = \hyperlink{main_8cpp_a0a53d01e06c71d6360afcb0fabf2aa8e}{eulerAngles}[2] * 3.141592653589 / 180.0;
498 \textcolor{comment}{}
499 \textcolor{comment}{                //! Send position and Euler angles over WiFi with 100 Hz}
500 \textcolor{comment}{}                \hyperlink{main_8cpp_a54b6b6db348b48d21e1265e22829c61f}{sendDataUDP}(\hyperlink{main_8cpp_ac6dab448fd1f9b3aed1205fbd8179f5d}{position}, \hyperlink{main_8cpp_a0a53d01e06c71d6360afcb0fabf2aa8e}{eulerAngles});
501 \textcolor{comment}{}
502 \textcolor{comment}{                //! Save the values in a log file, values are:}
503 \textcolor{comment}{                //! Time sinc tracking started  Position    Euler Angles    Velocity}
504 \textcolor{comment}{}                \hyperlink{main_8cpp_a267046e6c367b4c2dec18b9b772ab67a}{logfile}.open(\hyperlink{main_8cpp_a7a642b2c947e62ff5ec692ec95783bd0}{logName}, std::ios::app); \textcolor{comment}{//! Open the log file, the folder is
       RigidTrackInstallationFolder/logs}
505 \textcolor{comment}{}                \hyperlink{main_8cpp_a267046e6c367b4c2dec18b9b772ab67a}{logfile} << frame->TimeStamp() - \hyperlink{main_8cpp_ac7de3790df75e7d70bfe280b9af47a56}{timeFirstFrame} << \textcolor{stringliteral}{";"} << 
      \hyperlink{main_8cpp_ac6dab448fd1f9b3aed1205fbd8179f5d}{position}[0] << \textcolor{stringliteral}{";"} << \hyperlink{main_8cpp_ac6dab448fd1f9b3aed1205fbd8179f5d}{position}[1] << \textcolor{stringliteral}{";"} << \hyperlink{main_8cpp_ac6dab448fd1f9b3aed1205fbd8179f5d}{position}[2] << \textcolor{stringliteral}{";"};
506                 \hyperlink{main_8cpp_a267046e6c367b4c2dec18b9b772ab67a}{logfile} << \hyperlink{main_8cpp_a0a53d01e06c71d6360afcb0fabf2aa8e}{eulerAngles}[0] << \textcolor{stringliteral}{";"} << 
      \hyperlink{main_8cpp_a0a53d01e06c71d6360afcb0fabf2aa8e}{eulerAngles}[1] << \textcolor{stringliteral}{";"} << \hyperlink{main_8cpp_a0a53d01e06c71d6360afcb0fabf2aa8e}{eulerAngles}[2] << \textcolor{stringliteral}{";"};
507                 \hyperlink{main_8cpp_a267046e6c367b4c2dec18b9b772ab67a}{logfile} << \hyperlink{main_8cpp_a700b8df52e2beb702d06651ed6130e73}{velocity}[0] << \textcolor{stringliteral}{";"} << \hyperlink{main_8cpp_a700b8df52e2beb702d06651ed6130e73}{velocity}[1] << \textcolor{stringliteral}{";"} << 
      \hyperlink{main_8cpp_a700b8df52e2beb702d06651ed6130e73}{velocity}[2] << \textcolor{stringliteral}{"\(\backslash\)n"};
508                 \hyperlink{main_8cpp_a267046e6c367b4c2dec18b9b772ab67a}{logfile}.close(); \textcolor{comment}{//! Close the file to save values}
509 \textcolor{comment}{}            \}
510 \textcolor{comment}{}
511 \textcolor{comment}{            //! Check if the position and euler angles are below the allowed value, if yes send OKAY signal
       (1), if not send shutdown signal (0)}
512 \textcolor{comment}{            //! Absolute x, y and z position in navigation CoSy must be smaller than the allowed distance}
513 \textcolor{comment}{}            \textcolor{keywordflow}{if} (\hyperlink{main_8cpp_aa6266eedab8b3c011be53baffbfc42ab}{safetyEnable})
514             \{
515                 \textcolor{keywordflow}{if} ((abs(position[0]) < \hyperlink{main_8cpp_a2c1b807fcb2de5a6759bd60ccae6dd7e}{safetyBoxLength} && abs(position[1]) < 
      \hyperlink{main_8cpp_a2c1b807fcb2de5a6759bd60ccae6dd7e}{safetyBoxLength} && abs(position[2]) < \hyperlink{main_8cpp_a2c1b807fcb2de5a6759bd60ccae6dd7e}{safetyBoxLength}))
516                 \{\textcolor{comment}{}
517 \textcolor{comment}{                    //! Absolute Euler angles must be smaller than allowed value. Heading is not considered
       }
518 \textcolor{comment}{}                    \textcolor{keywordflow}{if} ((abs(eulerAngles[0]) < \hyperlink{main_8cpp_ae65386c3310ab826e84fba757296de9a}{safetyAngle} && abs(eulerAngles[1]) < 
      \hyperlink{main_8cpp_ae65386c3310ab826e84fba757296de9a}{safetyAngle}))
519                     \{\textcolor{comment}{}
520 \textcolor{comment}{                        //! Send the OKAY signal to the desired computer every 5th time}
521 \textcolor{comment}{}                        \textcolor{keywordflow}{if} (v == 5) \{
522                             \hyperlink{main_8cpp_ad44c6ce322034044d573e6d4678d630b}{data}.setNum((\textcolor{keywordtype}{int})(1));
523                             \hyperlink{main_8cpp_a6aa0c3a69dc10d5c4432dcf62e2155d3}{udpSocketSafety}->write(\hyperlink{main_8cpp_ad44c6ce322034044d573e6d4678d630b}{data}); \textcolor{comment}{//! Send the 1 }
524 \textcolor{comment}{}                            v = 0; \textcolor{comment}{//! reset the counter that is needed for decimation to every 5th time
       step}
525 \textcolor{comment}{}                        \}
526                     \}\textcolor{comment}{}
527 \textcolor{comment}{                    //! The euler angles of the object exceeded the allowed euler angles, send the shutdown
       signal (0)}
528 \textcolor{comment}{}                    \textcolor{keywordflow}{else}
529                     \{
530                         \hyperlink{main_8cpp_ad44c6ce322034044d573e6d4678d630b}{data}.setNum((\textcolor{keywordtype}{int})(0));  \textcolor{comment}{//! Send the shutdown signal, a 0 }
531 \textcolor{comment}{}                        \hyperlink{main_8cpp_a6aa0c3a69dc10d5c4432dcf62e2155d3}{udpSocketSafety}->write(\hyperlink{main_8cpp_ad44c6ce322034044d573e6d4678d630b}{data});
532                         \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"Object exceeded allowed Euler angles, shutdown signal sent."}
      ); \textcolor{comment}{//! Inform the user}
533 \textcolor{comment}{}
534                     \}
535                 \}\textcolor{comment}{}
536 \textcolor{comment}{                //! The position of the object exceeded the allowed position, shut the object down}
537 \textcolor{comment}{}                \textcolor{keywordflow}{else}
538                 \{
539                     \hyperlink{main_8cpp_ad44c6ce322034044d573e6d4678d630b}{data}.setNum((\textcolor{keywordtype}{int})(0));  \textcolor{comment}{//! Send the shutdown signal, a 0 }
540 \textcolor{comment}{}                    \hyperlink{main_8cpp_a6aa0c3a69dc10d5c4432dcf62e2155d3}{udpSocketSafety}->write(\hyperlink{main_8cpp_ad44c6ce322034044d573e6d4678d630b}{data});
541                     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"Object left allowed area, shutdown signal sent."}); \textcolor{comment}{//! Inform
       the user}
542 \textcolor{comment}{}
543                 \}
544             \}
545 \textcolor{comment}{}
546 \textcolor{comment}{            //! Inform the user if tracking system is disturbed (marker lost or so) or error was too big }
547 \textcolor{comment}{}            \textcolor{keywordflow}{if} (framesDropped > 10)
548             \{
549                 \textcolor{keywordflow}{if} (\hyperlink{main_8cpp_aa6266eedab8b3c011be53baffbfc42ab}{safetyEnable}) \textcolor{comment}{//! Also send the shutdown signal}
550 \textcolor{comment}{}                \{
551                     \hyperlink{main_8cpp_ad44c6ce322034044d573e6d4678d630b}{data}.setNum((\textcolor{keywordtype}{int})(0));  \textcolor{comment}{//! Send the shutdown signal, a 0 }
552 \textcolor{comment}{}                    \hyperlink{main_8cpp_a6aa0c3a69dc10d5c4432dcf62e2155d3}{udpSocketSafety}->write(\hyperlink{main_8cpp_ad44c6ce322034044d573e6d4678d630b}{data});
553                 \}
554                 \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(\textcolor{stringliteral}{"Lost marker points or precision was bad!"}); \textcolor{comment}{//! Inform the user}
555 \textcolor{comment}{}                framesDropped = 0;
556             \}
557 \textcolor{comment}{}
558 \textcolor{comment}{            //! Rasterize the frame so it can be shown in the GUI}
559 \textcolor{comment}{}            frame->Rasterize(cameraWidth, cameraHeight, matFrame.step, 
      \hyperlink{main_8cpp_ae144f2eb508ffc763c259d875c600ab2}{BACKBUFFER\_BITSPERPIXEL}, matFrame.data);
560 \textcolor{comment}{}
561 \textcolor{comment}{            //! Convert the frame from greyscale as it comes from the camera to rgb color }
562 \textcolor{comment}{}            cvtColor(matFrame, cFrame, COLOR\_GRAY2RGB);
563 \textcolor{comment}{}
564 \textcolor{comment}{            //! Project (draw) the marker CoSy origin into 2D and save it in the cFrame image}
565 \textcolor{comment}{}            \hyperlink{main_8cpp_a2104a5d9d6b9f1e29bc4cd858c59882e}{projectCoordinateFrame}(cFrame);
566 \textcolor{comment}{}
567 \textcolor{comment}{            //! Project the marker points from 3D to the camera image frame (2d) with the computed pose}
568 \textcolor{comment}{}            projectPoints(\hyperlink{main_8cpp_a933edb4ba1c0589d59020164c2f1ff87}{list\_points3d}, \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec}, \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}, 
      \hyperlink{main_8cpp_a53e8957a459b639ca82d938157f3b085}{cameraMatrix}, \hyperlink{main_8cpp_a8d67876da148be9118bba1c0d017fb57}{distCoeffs}, \hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d});
569             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; i++)
570             \{\textcolor{comment}{}
571 \textcolor{comment}{                //! Draw a circle around the projected points so the result can be better compared to the
       real marker position}
572 \textcolor{comment}{                //! In the resulting picture those are the red dots}
573 \textcolor{comment}{}                circle(cFrame, Point(\hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d}[i].x, 
      \hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d}[i].y), 3, Scalar(225, 0, 0), 3);
574             \}
575 \textcolor{comment}{}
576 \textcolor{comment}{            //! Write the current position, attitude and error values as text in the frame}
577 \textcolor{comment}{}            \hyperlink{main_8cpp_af6430ad2592a955a3618549547dfc5be}{drawPositionText}(cFrame, position, eulerAngles, projectionError);
578 \textcolor{comment}{}
579 \textcolor{comment}{            //! Send the new camera picture to the GUI and call the GUI processing routine}
580 \textcolor{comment}{}            QPixmap QPFrame;
581             QPFrame = \hyperlink{main_8cpp_a3e3cc959a7ab6f93ea52863d86373ce5}{Mat2QPixmap}(cFrame);
582             \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.changeImage(QPFrame); \textcolor{comment}{//! Update the picture in the GUI}
583 \textcolor{comment}{}            QCoreApplication::processEvents(); \textcolor{comment}{//! Give Qt time to handle everything}
584 \textcolor{comment}{}\textcolor{comment}{}
585 \textcolor{comment}{            //! Release the camera frame to fetch the new one}
586 \textcolor{comment}{}            frame->Release();
587         \}
588     \}
589 \textcolor{comment}{}
590 \textcolor{comment}{    //! User choose to stop the tracking, clean things up}
591 \textcolor{comment}{}    \hyperlink{main_8cpp_af2a8b7de0b15dc17198c147ba39e85f3}{closeUDP}(); \textcolor{comment}{//! Close the UDP connections so resources are deallocated}
592 \textcolor{comment}{}    camera->Release();  \textcolor{comment}{//! Release camera}
593 \textcolor{comment}{}    \textcolor{keywordflow}{return} 0;
594 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=309pt]{main_8h_a3d3afd29ce54eb7fc5cc7e74ab666586_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=279pt]{main_8h_a3d3afd29ce54eb7fc5cc7e74ab666586_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{main_8h_a847c0fbd3e513fb76ff145b31a9f5c37}\label{main_8h_a847c0fbd3e513fb76ff145b31a9f5c37}} 
\index{main.\+h@{main.\+h}!test\+Algorithms@{test\+Algorithms}}
\index{test\+Algorithms@{test\+Algorithms}!main.\+h@{main.\+h}}
\subsubsection{\texorpdfstring{test\+Algorithms()}{testAlgorithms()}}
{\footnotesize\ttfamily void test\+Algorithms (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Project some points from 3D to 2D and then check the accuracy of the algorithms. Mainly to generate something that can be shown in the camera view so the user knows everything loaded correctly. 

Definition at line 970 of file main.\+cpp.


\begin{DoxyCode}
971 \{
972 
973     \textcolor{keywordtype}{int} \_methodPNP;
974 
975     std::vector<Point2d> noise(\hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers});
976 
977     \hyperlink{main_8cpp_ae101daeaec726e27690c862b7edea825}{RvecOriginal} = \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec};
978     \hyperlink{main_8cpp_a043bf1deaf5d42d47e0cce8982c1f18b}{TvecOriginal} = \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec};
979 
980     projectPoints(\hyperlink{main_8cpp_a933edb4ba1c0589d59020164c2f1ff87}{list\_points3d}, \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec}, \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}, \hyperlink{main_8cpp_a53e8957a459b639ca82d938157f3b085}{cameraMatrix}, 
      \hyperlink{main_8cpp_a8d67876da148be9118bba1c0d017fb57}{distCoeffs}, \hyperlink{main_8cpp_a7b88d0425a68875639d40a17079df819}{list\_points2dProjected});
981 
982     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(\textcolor{stringliteral}{""});
983     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"Unsorted Points 2D Projected \(\backslash\)n"};
984     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \hyperlink{main_8cpp_a7b88d0425a68875639d40a17079df819}{list\_points2dProjected} << \textcolor{stringliteral}{"\(\backslash\)n"};
985     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(QString::fromStdString(\hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str()));
986 
987     Mat cFrame(480, 640, CV\_8UC3, Scalar(0, 0, 0));
988     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; i++)
989     \{
990         circle(cFrame, Point(list\_points2dProjected[i].x, list\_points2dProjected[i].y), 6, Scalar(0, 255, 0
      ), 3);
991     \}
992 
993     \hyperlink{main_8cpp_a2104a5d9d6b9f1e29bc4cd858c59882e}{projectCoordinateFrame}(cFrame);
994 
995     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(\textcolor{stringliteral}{""});
996     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"=====================================================\(\backslash\)n"};
997     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"================= Projected Points ==================\(\backslash\)n"};
998     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << list\_points2dProjected << \textcolor{stringliteral}{"\(\backslash\)n"};
999 
1000     randn(noise, 0, 0.5);
1001     add(list\_points2dProjected, noise, list\_points2dProjected);
1002 
1003     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"================ With Noise Points ==================\(\backslash\)n"};
1004     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << list\_points2dProjected << \textcolor{stringliteral}{"\(\backslash\)n"};
1005     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(QString::fromStdString(\hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str()));
1006 
1007 
1008     \textcolor{keywordtype}{bool} \hyperlink{main_8cpp_ab1cc9be1ff0871bc5de1eb4c2811ae3e}{useGuess} = \textcolor{keyword}{true};
1009     \_methodPNP = 0; \textcolor{comment}{//!< 0 = iterative 1 = EPNP 2 = P3P 4 = UPNP  //!< not used}
1010 \textcolor{comment}{}
1011     solvePnP(\hyperlink{main_8cpp_a933edb4ba1c0589d59020164c2f1ff87}{list\_points3d}, list\_points2dProjected, \hyperlink{main_8cpp_a53e8957a459b639ca82d938157f3b085}{cameraMatrix}, 
      \hyperlink{main_8cpp_a8d67876da148be9118bba1c0d017fb57}{distCoeffs}, \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec}, \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec}, useGuess, \_methodPNP);
1012 
1013     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(\textcolor{stringliteral}{""});
1014     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"=====================================================\(\backslash\)n"};
1015     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"==================== Iterative =====================\(\backslash\)n"};
1016     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"rvec: "} << \textcolor{stringliteral}{"\(\backslash\)n"};
1017     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \hyperlink{main_8cpp_ae095f10a005e68d20233dc15b4077ca6}{Rvec} << \textcolor{stringliteral}{"\(\backslash\)n"};
1018     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"tvec: "} << \textcolor{stringliteral}{"\(\backslash\)n"};
1019     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \hyperlink{main_8cpp_a9215ba881de0242c883e5b065d6d2ff9}{Tvec} << \textcolor{stringliteral}{"\(\backslash\)n"};
1020 
1021     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(QString::fromStdString(\hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str()));
1022 
1023     \_methodPNP = 1; \textcolor{comment}{//!< 0 = iterative 1 = EPNP 2 = P3P 4 = UPNP UPnP not used}
1024 \textcolor{comment}{}    Rvec = cv::Mat::zeros(3, 1, CV\_64F);
1025     Tvec = cv::Mat::zeros(3, 1, CV\_64F);
1026     solvePnP(\hyperlink{main_8cpp_a933edb4ba1c0589d59020164c2f1ff87}{list\_points3d}, list\_points2dProjected, \hyperlink{main_8cpp_a53e8957a459b639ca82d938157f3b085}{cameraMatrix}, 
      \hyperlink{main_8cpp_a8d67876da148be9118bba1c0d017fb57}{distCoeffs}, Rvec, Tvec, useGuess, \_methodPNP);
1027 
1028     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(\textcolor{stringliteral}{""});
1029     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"=====================================================\(\backslash\)n"};
1030     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"====================    EPNP    =====================\(\backslash\)n"};
1031     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"rvec: "} << \textcolor{stringliteral}{"\(\backslash\)n"};
1032     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << Rvec << \textcolor{stringliteral}{"\(\backslash\)n"};
1033     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"tvec: "} << \textcolor{stringliteral}{"\(\backslash\)n"};
1034     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << Tvec << \textcolor{stringliteral}{"\(\backslash\)n"};
1035 
1036     projectPoints(\hyperlink{main_8cpp_a933edb4ba1c0589d59020164c2f1ff87}{list\_points3d}, Rvec, Tvec, \hyperlink{main_8cpp_a53e8957a459b639ca82d938157f3b085}{cameraMatrix}, 
      \hyperlink{main_8cpp_a8d67876da148be9118bba1c0d017fb57}{distCoeffs}, list\_points2dProjected);
1037     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; i++)
1038     \{
1039         circle(cFrame, Point(list\_points2dProjected[i].x, list\_points2dProjected[i].y), 3, Scalar(255, 0, 0
      ), 3);
1040     \}
1041     QPixmap QPFrame;
1042     QPFrame = \hyperlink{main_8cpp_a3e3cc959a7ab6f93ea52863d86373ce5}{Mat2QPixmap}(cFrame);
1043     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.changeImage(QPFrame);
1044     QCoreApplication::processEvents();
1045     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(QString::fromStdString(\hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str()));
1046     \textcolor{keywordflow}{if} (numberMarkers == 4)
1047     \{
1048         \_methodPNP = 2; \textcolor{comment}{//!< 0 = iterative 1 = EPNP 2 = P3P 4 = UPNP  //!< not used}
1049 \textcolor{comment}{}        Rvec = cv::Mat::zeros(3, 1, CV\_64F);
1050         Tvec = cv::Mat::zeros(3, 1, CV\_64F);
1051         solvePnP(\hyperlink{main_8cpp_a933edb4ba1c0589d59020164c2f1ff87}{list\_points3d}, list\_points2dProjected, 
      \hyperlink{main_8cpp_a53e8957a459b639ca82d938157f3b085}{cameraMatrix}, \hyperlink{main_8cpp_a8d67876da148be9118bba1c0d017fb57}{distCoeffs}, Rvec, Tvec, useGuess, \_methodPNP);
1052 
1053         \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(\textcolor{stringliteral}{""});
1054         \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"=====================================================\(\backslash\)n"};
1055         \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"====================     P3P    =====================\(\backslash\)n"};
1056         \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"rvec: "} << \textcolor{stringliteral}{"\(\backslash\)n"};
1057         \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << Rvec << \textcolor{stringliteral}{"\(\backslash\)n"};
1058         \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"tvec: "} << \textcolor{stringliteral}{"\(\backslash\)n"};
1059         \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << Tvec << \textcolor{stringliteral}{"\(\backslash\)n"};
1060 
1061         projectPoints(\hyperlink{main_8cpp_a933edb4ba1c0589d59020164c2f1ff87}{list\_points3d}, Rvec, Tvec, \hyperlink{main_8cpp_a53e8957a459b639ca82d938157f3b085}{cameraMatrix}, 
      \hyperlink{main_8cpp_a8d67876da148be9118bba1c0d017fb57}{distCoeffs}, list\_points2dProjected);
1062         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < \hyperlink{main_8cpp_ae1d37a43f631aefe76b6e540da786064}{numberMarkers}; i++)
1063         \{
1064             circle(cFrame, Point(list\_points2dProjected[i].x, list\_points2dProjected[i].y), 3, Scalar(255, 
      0, 0), 3);
1065         \}
1066         \textcolor{keywordtype}{double} projectionError = norm(list\_points2dProjected, \hyperlink{main_8cpp_ad583e75f176dafdb7de3f214673851de}{list\_points2d});
1067         putText(cFrame, \textcolor{stringliteral}{"Testing Algorithms Finished"}, cv::Point(5, 420), 1, 1, cv::Scalar(255, 255, 255));
1068         \hyperlink{main_8cpp_af6430ad2592a955a3618549547dfc5be}{drawPositionText}(cFrame, \hyperlink{main_8cpp_ac6dab448fd1f9b3aed1205fbd8179f5d}{position}, \hyperlink{main_8cpp_a0a53d01e06c71d6360afcb0fabf2aa8e}{eulerAngles}, projectionError)
      ;
1069 
1070         QPixmap QPFrame;
1071         QPFrame = \hyperlink{main_8cpp_a3e3cc959a7ab6f93ea52863d86373ce5}{Mat2QPixmap}(cFrame);
1072         \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.changeImage(QPFrame);
1073         QCoreApplication::processEvents();
1074         \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(QString::fromStdString(\hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str()));
1075     \}
1076 
1077     \_methodPNP = 4; \textcolor{comment}{//!< 0 = iterative 1 = EPNP 2 = P3P 4 = UPNP  //!< not used}
1078 \textcolor{comment}{}    Rvec = cv::Mat::zeros(3, 1, CV\_64F);
1079     Tvec = cv::Mat::zeros(3, 1, CV\_64F);
1080     solvePnP(\hyperlink{main_8cpp_a933edb4ba1c0589d59020164c2f1ff87}{list\_points3d}, list\_points2dProjected, \hyperlink{main_8cpp_a53e8957a459b639ca82d938157f3b085}{cameraMatrix}, 
      \hyperlink{main_8cpp_a8d67876da148be9118bba1c0d017fb57}{distCoeffs}, Rvec, Tvec, useGuess, \_methodPNP);
1081 
1082     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str(\textcolor{stringliteral}{""});
1083     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"=====================================================\(\backslash\)n"};
1084     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"====================    UPNP    =====================\(\backslash\)n"};
1085     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"rvec: "} << \textcolor{stringliteral}{"\(\backslash\)n"};
1086     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << Rvec << \textcolor{stringliteral}{"\(\backslash\)n"};
1087     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << \textcolor{stringliteral}{"tvec: "} << \textcolor{stringliteral}{"\(\backslash\)n"};
1088     \hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss} << Tvec << \textcolor{stringliteral}{"\(\backslash\)n"};
1089 
1090     \hyperlink{main_8cpp_af29e7fc07ae0979d5fb61b473241d33d}{commObj}.addLog(QString::fromStdString(\hyperlink{main_8cpp_a8fc3524f4e679a41dcc8d0f302d637ed}{ss}.str()));
1091 
1092     Rvec = \hyperlink{main_8cpp_ae101daeaec726e27690c862b7edea825}{RvecOriginal};
1093     Tvec = \hyperlink{main_8cpp_a043bf1deaf5d42d47e0cce8982c1f18b}{TvecOriginal};
1094 
1095 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=316pt]{main_8h_a847c0fbd3e513fb76ff145b31a9f5c37_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=234pt]{main_8h_a847c0fbd3e513fb76ff145b31a9f5c37_icgraph}
\end{center}
\end{figure}


\subsection{Variable Documentation}
\mbox{\Hypertarget{main_8h_af29e7fc07ae0979d5fb61b473241d33d}\label{main_8h_af29e7fc07ae0979d5fb61b473241d33d}} 
\index{main.\+h@{main.\+h}!comm\+Obj@{comm\+Obj}}
\index{comm\+Obj@{comm\+Obj}!main.\+h@{main.\+h}}
\subsubsection{\texorpdfstring{comm\+Obj}{commObj}}
{\footnotesize\ttfamily comm\+Object comm\+Obj}



class that handles the communication from \hyperlink{main_8cpp}{main.\+cpp} to the G\+UI 

Now declare variables that are used across the \hyperlink{main_8cpp}{main.\+cpp} file. Basically almost every variable used is declared here. 

Definition at line 68 of file main.\+cpp.

